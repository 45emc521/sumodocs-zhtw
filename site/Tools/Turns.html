<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta property="og:image" content="../images/image-facebook.jpg">
        <meta property="og:image:type" content="image/jpeg">
        <meta property="og:image:width" content="1080">
        <meta property="og:image:height" content="1080">

        
        
        <link rel="canonical" href="https://sumo.dlr.de/docs/Tools/Turns.html">
        <link rel="shortcut icon" href="../images/favicon.ico">
        <title>Turns - SUMO 使用者文件（正體中文）－SUMO Documentation (Chinese Tradditional)</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="apple-touch-icon" href="../images/apple-touch-icon.png">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 

      <script>
        // DARK MODE
        function detectColorScheme(){
          var theme="light";

          if(localStorage.getItem("sumo-docs-theme")){
              if(localStorage.getItem("sumo-docs-theme") == "dark"){
                  var theme = "dark";
              }
          } else if(!window.matchMedia) {
              return false;
          } else if(window.matchMedia("(prefers-color-scheme: dark)").matches) {
              var theme = "dark";
          }

          if (theme=="dark") {
              document.documentElement.setAttribute("data-theme", "dark");
          }
        }
        detectColorScheme();
      </script>

    </head>

    <body>

        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary text-center">
            <div class="container-fluid">
                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../index.html" class="nav-link">Documentation</a>
                            </li>
                            <li class="navitem">
                                <a href="../Tutorials/index.html" class="nav-link">Tutorials</a>
                            </li>
                            <li class="navitem">
                                <a href="../FAQ.html" class="nav-link">FAQ</a>
                            </li>
                            <li class="navitem">
                                <a href="../Downloads.html" class="nav-link">Downloads</a>
                            </li>
                            <li class="navitem">
                                <a href="../Publications.html" class="nav-link">Publications</a>
                            </li>
                            <li class="navitem">
                                <a href="../Developer/index.html" class="nav-link">Developer</a>
                            </li>
                            <li class="navitem">
                                <a href="../ChangeLog.html" class="nav-link">ChangeLog</a>
                            </li>
                            <li class="navitem">
                                <a href="https://eclipse.org/sumo/contact/" class="nav-link">Contact</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> <u>S</u>earch
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="edit" href="https://github.com/45EMC521/sumodocs-zhtw/edit/main/docs/web/docs/Tools/Turns.md" class="nav-link"><i class="fa fa-github"></i> <u>E</u>dit on GitHub</a>
                            </li>
                      <li class="nav-item dropdown">
                          <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            More <i class="fa fa-chevron-circle-down"></i>
                          </a>
                          <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item no-arrow-link" href="https://github.com/eclipse/sumo/issues">Report a Bug / Issue / Typo</a>
                            <a class="dropdown-item" href="../Editing_Articles.html">Help on editing articles</a>
                            <a class="dropdown-item" href="https://github.com/eclipse/sumo/commits/main/docs/web">Recent documentation changes</a>
                            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#mkdocs_keyboard_modal">Keyboard Shortcuts</a>
                            <a class="dropdown-item no-arrow-link" href="https://sumo.dlr.de/sumo_documentation.zip">Download the Documentation</a>
                            <span class="dropdown-item" id="dark-mode-div">Dark mode <label id="theme-switch" class="theme-switch" for="checkbox_theme">
                              <input type="checkbox" id="checkbox_theme">
                          </label></span>
                          </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container-fluid">
          <div class="row">
                <div class="col-md-3">
                  <div class="text-center"><a href="../index.html" style="display: inline-block; margin-top: 5px;"><img src="../images/sumo-logo.png" class="sumoLogo" alt="SUMO Logo" width="120px"></a></div>
                  
<div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary toc-scroll toc">
        <ul class="nav flex-column bs-sidenav">
            <p style="margin-top:5px; color:#777777;" class="text-center">Contents</p>
            <li class="nav-item main"><a href="#routesamplerpy">routeSampler.py</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#edge_counts" class="nav-link">• edge counts</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#obtaining_counting_data_files" class="nav-link">• Obtaining counting data files</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#turn_counts" class="nav-link">• turn counts</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#obtaining_initial_routes" class="nav-link">• Obtaining initial routes</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#generalized_route_restrictions" class="nav-link">• Generalized route restrictions</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#origin-destination_restrictions" class="nav-link">• Origin-Destination restrictions</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#output_styles" class="nav-link">• Output Styles</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#vehicle_attributes" class="nav-link">• Vehicle attributes</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#multiple_vehicle_types" class="nav-link">• Multiple vehicle types</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#sampling" class="nav-link">• Sampling</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#optimization" class="nav-link">• Optimization</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#further_calibration" class="nav-link">• Further Calibration</a>
                </li>
            <li class="nav-item main"><a href="#generateturnratiospy">generateTurnRatios.py</a></li>
            <li class="nav-item main"><a href="#generateturndefspy">generateTurnDefs.py</a></li>
            <li class="nav-item main"><a href="#turncount2edgecountpy">turnCount2EdgeCount.py</a></li>
            <li class="nav-item main"><a href="#turnfile2edgerelationspy">turnFile2EdgeRelations.py</a></li>
            <li class="nav-item main"><a href="#jtcrouterpy">jtcrouter.py</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#turn_count_data_format" class="nav-link">• Turn count data format</a>
                </li>
        </ul>
    </div>

    <div class="admonition conference" style="position: sticky; margin-top: 20px; margin-bottom:10px;">
        <p>歡迎您造訪 <a href="https://eclipse.org/sumo">eclipse.org/sumo</a>。</p>
        <p>本份文件是基於原文版的 SUMO Documentation 於 2022/04/01 的快取所翻譯的。<strong>鑑於文件為自由編輯，且經常修改，如要閱讀最新的文件內容，請至原文網站 <a href="https://sumo.dlr.de/docs/">SUMO Documentation</a> 了解詳情。</strong></p>
        </div>

</div>
                  <!--  -->
                </div>
                <div class="col-md-9 main-area" role="main">
                   <!-- page.is_homepage seems to be broken in Mkdocs > 1.1.0 -->
                  <ul class="breadcrumbs">
    <script>
        var pagePath = "/docs/Tools/Turns.html";
        var splitUrl = pagePath.split("/");
        splitUrl.pop();
        splitUrl.shift();
        if (splitUrl[0] == 'docs') splitUrl.shift();
        var homeLink = "../index.html";
        document.write('<li class="breadcrumb-item"><a href="' + homeLink + '"><i class="fa fa-home"></i></a></li>');
        var prev = '';
        
        var dirLink = splitUrl.map(function (el) {
        el = prev + el; prev = el + '/'; return el;
        });

        for (i = 0; i < splitUrl.length; i++) {
            document.write("<li class=\"breadcrumb-item\"><a class=\"no-arrow-link\" href=\"../" + dirLink[i] + "\">" + splitUrl[i] + "</a></li>");
        }
    </script>
    <li class="breadcrumb-item active">Turns</li>
</ul>
                  <hTitles>Turns<hr style="border: 0.5px solid #338033; margin-top: 5px !important;"></hTitles>
                  
                  

<h1 id="routesamplerpy">routeSampler.py<a class="headerlink" href="#routesamplerpy" title="Permanent link">#</a></h1>
<p>The script generates traffic (routed vehicles or flows) from <em>any combination</em> of turn-count data, edge-count and even origin-destination-count data. It requires a route file as input that defines possible routes. Routes are sampled (heuristically) from the input so that
the resulting traffic fulfills the counting data.</p>
<h2 id="edge_counts">edge counts<a class="headerlink" href="#edge_counts" title="Permanent link">#</a></h2>
<p>The data, most frequently available takes the form of traffic counts on roads (edges). This data can be passed to routeSampler.py in an <a href="../Simulation/Output/Lane-_or_Edge-based_Traffic_Measures.html">edgeData
file</a> using option <strong>--edgedata-files</strong>.</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">routeSampler</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">r</span> <span class="o">&lt;</span><span class="n">input</span><span class="o">-</span><span class="n">route</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">edgedata</span><span class="o">-</span><span class="n">files</span> <span class="o">&lt;</span><span class="n">edgedata</span><span class="o">-</span><span class="n">files</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">output</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span>
</code></pre></div>

<p>Only the edge attribute 'id' and another attribute for the traffic count are needed:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;data&gt;</span>
    <span class="nt">&lt;interval</span> <span class="na">id=</span><span class="s">&quot;arbitrary&quot;</span> <span class="na">begin=</span><span class="s">&quot;0.0&quot;</span> <span class="na">end=</span><span class="s">&quot;300&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;edge</span> <span class="na">id=</span><span class="s">&quot;-58&quot;</span> <span class="na">entered=</span><span class="s">&quot;4&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;edge</span> <span class="na">id=</span><span class="s">&quot;45&quot;</span> <span class="na">entered=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;edge</span> <span class="na">id=</span><span class="s">&quot;-31&quot;</span> <span class="na">entered=</span><span class="s">&quot;15&quot;</span><span class="nt">/&gt;</span>       
        ...
     <span class="nt">&lt;/interval&gt;</span>
     ...
<span class="nt">&lt;/data&gt;</span>
</code></pre></div>

<p>The attributes for reading the counts from edge-data file can be set with option <strong>--edgedata-attribute</strong> (default 'entered')</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default attribute is 'entered' because this attribute corresponds best to the through-traffic count in sumo-generated edgeData files.</p>
</div>
<h2 id="obtaining_counting_data_files">Obtaining counting data files<a class="headerlink" href="#obtaining_counting_data_files" title="Permanent link">#</a></h2>
<p>When using routeSampler as a replacement for <a href="../dfrouter.html">dfrouter</a> or <a href="Detector.html#flowrouterpy">flowrouter.py</a>, the flow input files can be converted to edgeData files with the tool <a href="Detector.html#edgedatafromflowpy">edgeDataFromFlow.py</a></p>
<p>For smaller scenarios it is often feasible to define edgeData files with <a href="../Netedit/elementsData.html">netedit edgeData mode (in the 'Data' supermode)</a>. Turn files can also be created with netedit using the edgeRelation mode (also part of the 'Data' supermode).</p>
<p>In other cases it is necessary to write custom code for converting counting data into the required format.</p>
<p>Further source for edgeData files are listed at the <a href="../sumo-gui.html#visualizing_edge-related_data">visualizing edge related data</a> page.</p>
<h2 id="turn_counts">turn counts<a class="headerlink" href="#turn_counts" title="Permanent link">#</a></h2>
<p>Traffic counts related to turning traffic can be provided in the following format:</p>
<p>The turn-count data must be provided in the format:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;data&gt;</span>
  <span class="nt">&lt;interval</span> <span class="na">id=</span><span class="s">&quot;generated&quot;</span> <span class="na">begin=</span><span class="s">&quot;0.0&quot;</span> <span class="na">end=</span><span class="s">&quot;99.0&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;-58.121.42&quot;</span> <span class="na">to=</span><span class="s">&quot;64&quot;</span> <span class="na">count=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;-58.121.42&quot;</span> <span class="na">to=</span><span class="s">&quot;-31&quot;</span> <span class="na">count=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;45&quot;</span> <span class="na">to=</span><span class="s">&quot;-68&quot;</span> <span class="na">count=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;-31.80.00&quot;</span> <span class="na">to=</span><span class="s">&quot;31&quot;</span> <span class="na">count=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;-31.80.00&quot;</span> <span class="na">to=</span><span class="s">&quot;37&quot;</span> <span class="na">count=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;-31.80.00&quot;</span> <span class="na">to=</span><span class="s">&quot;-23&quot;</span> <span class="na">count=</span><span class="s">&quot;13&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;-92.180.00&quot;</span> <span class="na">to=</span><span class="s">&quot;-60&quot;</span> <span class="na">count=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/interval&gt;</span>
<span class="nt">&lt;/data&gt;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">routeSampler</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">r</span> <span class="o">&lt;</span><span class="n">input</span><span class="o">-</span><span class="n">route</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">turn</span><span class="o">-</span><span class="n">files</span> <span class="o">&lt;</span><span class="n">turn</span><span class="o">-</span><span class="n">files</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">output</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span>
</code></pre></div>

<p>The attributes for reading the counts from the turn-data file can be set with option <strong>--turn-attribute</strong> (default 'count')</p>
<h2 id="obtaining_initial_routes">Obtaining initial routes<a class="headerlink" href="#obtaining_initial_routes" title="Permanent link">#</a></h2>
<p>Routes generated by randomTrips.py (<strong>--route-output</strong>) can be a good input source. The following randomTrips.py options may be helpful:</p>
<ul>
<li><strong>--fringe-factor</strong>: setting a high value will generated lots of through-traffic which is plausible for small networks</li>
<li><strong>--min-distance</strong>: restricting short routes increases the chance that routes passing multiple counting locations are generated</li>
<li><strong>--speed-exponent</strong>, <strong>--lanes</strong>: both options can be used to increase routes starting and ending on "important" roads. This combines well with the <strong>--fringe-factor</strong>-option to generate many routes that enter and leave the network on major roads.</li>
<li><strong>--random-routing-factor</strong>: randomly disturb the route choice so that trips with the same origin and destination may use different routes. Values must be larger than 1. A value of 2 may change the apparent travel time on an edge by up to to between 100% and 200% of it's empty-network-travel-time. This ensures that the resulting routes take at most twice as long as the "fastest" route. The value is randomized anew for each vehicle so there are no systematic biases.</li>
</ul>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">randomTrips</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">input</span><span class="o">-</span><span class="n">net</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">r</span> <span class="n">sampleRoutes</span><span class="o">.</span><span class="n">rou</span><span class="o">.</span><span class="n">xml</span>
<span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">routeSampler</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">r</span> <span class="n">sampleRoutes</span><span class="o">.</span><span class="n">rou</span><span class="o">.</span><span class="n">xml</span> <span class="o">--</span><span class="n">edgedata</span><span class="o">-</span><span class="n">files</span> <span class="o">&lt;</span><span class="n">edgedata</span><span class="o">-</span><span class="n">files</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">output</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>departure times in route files are ignored and only the <code>&lt;route&gt;</code>-elements are used. Route with named routes but without vehicles may also be used.</p>
</div>
<h2 id="generalized_route_restrictions">Generalized route restrictions<a class="headerlink" href="#generalized_route_restrictions" title="Permanent link">#</a></h2>
<p>By default, the input options --edgedata-files and --turn-files allow restricting counts for single edges and pairs of consecutive edges. </p>
<p>To define count restrictions for longer consecutive edge sequences the optional 'via' attribute can be used for <code>&lt;edgeRelation&gt;</code> elements:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;A&quot;</span> <span class="na">to=</span><span class="s">&quot;D&quot;</span> <span class="na">via=</span><span class="s">&quot;B C&quot;</span> <span class="na">count=</span><span class="s">&quot;42&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>

<p>To define count restrictions on non-consecutive edges the option <strong>--turn-max-gap <INT></strong> can be used. Example:
When setting option <strong>--turn-max-gap 2</strong>, the edgeRelation <code>&lt;edgeRelation from="A" to="D" .../&gt;</code> would apply to routes containing "A B", "A X D" or "A X Y D" but not "A X Y Z D".</p>
<h2 id="origin-destination_restrictions">Origin-Destination restrictions<a class="headerlink" href="#origin-destination_restrictions" title="Permanent link">#</a></h2>
<p>When loading an edgeRelation file with the option <strong>--od-files</strong>, origin-destination counts will be added.
This can be used to combine (edge-based) OD-relations with other counting data.  </p>
<p>The tool <a href="Routes.html#route2odpy">route2OD.py</a> supports option <strong>--edge-relations</strong> to transform any kind of route file into a suitable file of edge-based origin-destination edgeRelations.</p>
<h2 id="output_styles">Output Styles<a class="headerlink" href="#output_styles" title="Permanent link">#</a></h2>
<p>By default, routeSampler will generate individual vehicles with embedded routes. This can be changed with the following options (which can also be combined):</p>
<ul>
<li><strong>--write-route-ids</strong>: write named routes and let vehicles reference the route via it's id</li>
<li><strong>--wroute-route-distribution STR</strong>: put all routes into a route distribution (with appropriate route probabilities) and let a all vehicles reference this distribution (Simulation counts will then vary due to sampling from the distribution)</li>
<li><strong>--write-flows number</strong>: write <code>&lt;flow&gt;</code>-definitions instead of vehicles. The exact number of flow vehicles will be spaced evenly between the earliest and latest vehicle departures that would have been generated by default</li>
<li><strong>--write-flows probability</strong>: write <code>&lt;flow&gt;</code>-definitions instead of vehicles. Flows will be defined with attribute 'probability' so that the expected number of vehicles is equal to the number of vehicles that would have been generated by default but the specific number will vary due to sampling effects</li>
<li><strong>--pedestrians</strong>: write persons and personFlows with walks instead of vehicles and flows</li>
<li><strong>--prefix</strong>: prefix vehicle- and route-IDs with the given string. This is needed to combine output of multiple routeSampler runs (i.e. for different modes of traffic) into a single simulation. Otherwise there would be errors regarding duplicate IDs.</li>
</ul>
<h2 id="vehicle_attributes">Vehicle attributes<a class="headerlink" href="#vehicle_attributes" title="Permanent link">#</a></h2>
<p>With the option <strong>--attributes</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;STRING&gt;</em></a>, additional parameters can be given to the generated
vehicles (note, usage of the quoting characters).</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">routeSampler</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">n</span> <span class="n">input_net</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">r</span> <span class="n">candidate</span><span class="o">.</span><span class="n">rou</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">o</span> <span class="n">out</span><span class="o">.</span><span class="n">rou</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">d</span> <span class="n">data</span><span class="o">.</span><span class="n">xml</span>
  <span class="o">--</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;departLane=</span><span class="se">\&quot;</span><span class="s2">best</span><span class="se">\&quot;</span><span class="s2"> departSpeed=</span><span class="se">\&quot;</span><span class="s2">max</span><span class="se">\&quot;</span><span class="s2"> departPos=</span><span class="se">\&quot;</span><span class="s2">random</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
</code></pre></div>

<p>The above attributes would make the vehicles be distributed randomly on their
starting edges and inserted with high speed on a reasonable lane.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Quoting of trip attributes on Linux may also use the style <strong>--attributes 'departLane="best" departSpeed="max" departPos="random"'</strong></p>
</div>
<h2 id="multiple_vehicle_types">Multiple vehicle types<a class="headerlink" href="#multiple_vehicle_types" title="Permanent link">#</a></h2>
<p>To distinguish vehicles of different types, routeSampler may be run multiple times with different attributes. Note, that it is also necessary to set the option <strong>--prefix</strong> to prevent duplicate ids. The example below creates traffic consisting of cars and trucks using two edgedata files with distinct count values (stored in the default attribute 'entered').</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">routeSampler</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;type=</span><span class="se">\&quot;</span><span class="s2">car</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">--</span><span class="n">edgedata</span><span class="o">-</span><span class="n">files</span> <span class="n">carcounts</span><span class="o">.</span><span class="n">xml</span> <span class="o">--</span><span class="n">prefix</span> <span class="n">c</span> <span class="o">-</span><span class="n">o</span> <span class="n">cars</span><span class="o">.</span><span class="n">rou</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">r</span> <span class="n">candidate</span><span class="o">.</span><span class="n">rou</span><span class="o">.</span><span class="n">xml</span>
<span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">routeSampler</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;type=</span><span class="se">\&quot;</span><span class="s2">heavy</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">--</span><span class="n">edgedata</span><span class="o">-</span><span class="n">files</span> <span class="n">truckcounts</span><span class="o">.</span><span class="n">xml</span> <span class="o">--</span><span class="n">prefix</span> <span class="n">t</span> <span class="o">-</span><span class="n">o</span> <span class="n">trucks</span><span class="o">.</span><span class="n">rou</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">r</span> <span class="n">candidate</span><span class="o">.</span><span class="n">rou</span><span class="o">.</span><span class="n">xml</span>
</code></pre></div>

<p>Alternatively, the count values might also be stored in different attributes of the same file (i.e. 'count1', 'count2'):</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">routeSampler</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;type=</span><span class="se">\&quot;</span><span class="s2">car</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">--</span><span class="n">edgedata</span><span class="o">-</span><span class="n">files</span> <span class="n">counts</span><span class="o">.</span><span class="n">xml</span> <span class="o">--</span><span class="n">edgedata</span><span class="o">-</span><span class="n">attribute</span> <span class="n">count1</span> <span class="o">--</span><span class="n">prefix</span> <span class="n">c</span> <span class="o">-</span><span class="n">o</span> <span class="n">cars</span><span class="o">.</span><span class="n">rou</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">r</span> <span class="n">candidate</span><span class="o">.</span><span class="n">rou</span><span class="o">.</span><span class="n">xml</span>
<span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">routeSampler</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;type=</span><span class="se">\&quot;</span><span class="s2">heavy</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">--</span><span class="n">edgedata</span><span class="o">-</span><span class="n">files</span> <span class="n">counts</span><span class="o">.</span><span class="n">xml</span> <span class="o">--</span><span class="n">edgedata</span><span class="o">-</span><span class="n">attribute</span> <span class="n">count2</span> <span class="o">--</span><span class="n">prefix</span> <span class="n">t</span> <span class="o">-</span><span class="n">o</span> <span class="n">trucks</span><span class="o">.</span><span class="n">rou</span><span class="o">.</span><span class="n">xml</span>  <span class="o">-</span><span class="n">r</span>  <span class="n">candidate</span><span class="o">.</span><span class="n">rou</span><span class="o">.</span><span class="n">xml</span>
</code></pre></div>

<p>When running the simulation, the types 'car' and 'heavy' (previously set as vehicle attributes), must be defined in an additional file which could look like the following example (types.add.xml):</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;additional&gt;</span>
  <span class="nt">&lt;vType</span> <span class="na">id=</span><span class="s">&quot;car&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;vType</span> <span class="na">id=</span><span class="s">&quot;heavy&quot;</span> <span class="na">vClass=</span><span class="s">&quot;truck&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/additional&gt;</span>
</code></pre></div>

<p>The simulation could then be called like this:</p>
<div class="codehilite"><pre><span></span><code>  sumo -n net.net.xml -a types.add.xml -r cars.rou.xml,trucks.rou.xml
</code></pre></div>

<h2 id="sampling">Sampling<a class="headerlink" href="#sampling" title="Permanent link">#</a></h2>
<p>By default, sampling will be performed iteratively by 
1) selecting a random counting location that has not yet reached it's count (and which still has viable routes)
2) selecting a random route that passes this counting location</p>
<p>until all counting locations have reached their measured count or there are no viable routes (routes which have all their passed counting locations below the input count)</p>
<p>By setting the option <strong>--weighted</strong>. The sampling algorithm is changed. For each route a probability value is loaded from the input. The probability can either be specified explicitly using route attribute 'probability' or implicitly if a route with the same sequence of edges appears multiple times in the the route input. Sampling will be performed iteratively by
1) selecting a random viable route sampled by probability</p>
<p>until all counting locations have reached their measured count or there are no viable routes (routes which have all their passed counting locations below the input count)</p>
<h2 id="optimization">Optimization<a class="headerlink" href="#optimization" title="Permanent link">#</a></h2>
<p>By default, routes will be sampled from the input route set until no further routes can be added without exceeding one of the counts. This may still leave some counts below their target values.</p>
<p>The problem of selecting a multi-set of route so that all count values are matched can be formulated as an <a href="https://en.wikipedia.org/wiki/Integer_programming">Integer linear programming problem (ILP)</a>.</p>
<p>RouteSampler computes an approximate solution to this ILP by relaxing it to a linear programming problem (LP) and passing it to an LP-solver library (scipy).
  The resulting non-integral solution is then rounded to an integer solution.<br />
It is often desirable to find an optimized solution that is close to the initial sampling-solution. This way, route probabilities that were part of the input can be maintained to some degree.</p>
<p>By setting option <strong>--optimize <code>&lt;INT&gt;</code></strong>. The number of times that a route is used can be changed by up to <strong><code>&lt;INT&gt;</code></strong> times. This defines a trade-off between using routes in the same distribution as found in the input and optimizing the counts.
When setting option <strong>--optimize full</strong>. No constraints on the route distribution are set and any route can be used as often as needed to reach the counts.</p>
<p>The option <strong>--minimize-vehicles <FLOAT></strong> can be used to configure a weighting term for simultaneously minimizing the total number of used routes (vehicles).
  A higher value, favours solutions with few vehicles that pass multiple counting locations rather than more vehicles that pass fewer locations. Hard constraints on the minimum number of counting locations passed by each route can also be set with option <strong>-min-count</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Optimization requires <a href="https://www.scipy.org/">scipy</a>.</p>
</div>
<h2 id="further_calibration">Further Calibration<a class="headerlink" href="#further_calibration" title="Permanent link">#</a></h2>
<p>It is possible to load the resulting output into routeSampler.py for another round of optimization. By setting the option <strong>--optimize-input</strong> the sampling step is skipped and the optimizer is run directly on the input route set.</p>
<p>By removing specific routes or adding new ones, the user can thus tailor the generating traffic in an iterative manner.</p>
<h1 id="generateturnratiospy">generateTurnRatios.py<a class="headerlink" href="#generateturnratiospy" title="Permanent link">#</a></h1>
<p>This script is used to calculate the turn ratios from a
an edge to its downstream edge with a given route file. The output file
can be directly used as input in <a href="../jtrrouter.html">jtrrouter</a>. The time interval will span the minimum and maximum departure times of the route file.</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">turn</span><span class="o">-</span><span class="n">defs</span><span class="o">/</span><span class="n">generateTurnRatios</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">r</span> <span class="o">&lt;</span><span class="n">route</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span>
</code></pre></div>

<p>The standard output is the traffic volumes (which jtrrouter normalizes automatically). With the option <strong>-p</strong>,  turning ratios will be written as values from [0,1].</p>
<h1 id="generateturndefspy">generateTurnDefs.py<a class="headerlink" href="#generateturndefspy" title="Permanent link">#</a></h1>
<p>This script allows generation of the turn definitions based on the
number of lanes allowing particular turns. The basic functionality
distributes the traffic uniformly, that is:</p>
<ol>
<li>distribute the incoming traffic uniformly across the lanes forming
    the road</li>
<li>distribute the amount of traffic assigned to each lane uniformly
    among the destinations that the lane allows turns to.</li>
<li>sum up the values for each of the destinations that the road being
    processed allows turning to.</li>
</ol>
<p>Example use</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">turn</span><span class="o">-</span><span class="n">defs</span><span class="o">/</span><span class="n">generateTurnDefs</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">connections</span><span class="o">-</span><span class="n">file</span> <span class="n">connections</span><span class="o">.</span><span class="n">con</span><span class="o">.</span><span class="n">xml</span> <span class="o">--</span><span class="n">turn</span><span class="o">-</span><span class="n">definitions</span><span class="o">-</span><span class="n">file</span> <span class="n">output</span><span class="o">.</span><span class="n">turndefs</span><span class="o">.</span><span class="n">xml</span>
</code></pre></div>

<p>The script allows to be extended with new traffic distribution policies
(for example, based on Gaussian distribution) easily. See the
<em>DestinationWeightCalculator</em> class for details.</p>
<p>The script processes the connections given in the provided <em>*.con.xml</em>
file. For usage details, execute the <em>generateTurnDefs.py</em> script with
<em>--help</em> option.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can generate a connections file with all the connections in the network using <a href="../netconvert.html">netconvert</a> - see the <em>--plain-output-prefix</em> option.</p>
</div>
<h1 id="turncount2edgecountpy">turnCount2EdgeCount.py<a class="headerlink" href="#turncount2edgecountpy" title="Permanent link">#</a></h1>
<p>This script converts turn-count data into <a href="../Simulation/Output/Lane-_or_Edge-based_Traffic_Measures.html">edgeData</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">turn</span><span class="o">-</span><span class="n">defs</span><span class="o">/</span><span class="n">turnCount2EdgeCount</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">turn</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">output</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span>
</code></pre></div>

<h1 id="turnfile2edgerelationspy">turnFile2EdgeRelations.py<a class="headerlink" href="#turnfile2edgerelationspy" title="Permanent link">#</a></h1>
<p>This script converts the deprecated turn-file format into edgeRelation format</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">turn</span><span class="o">-</span><span class="n">defs</span><span class="o">/</span><span class="n">turnFile2EdgeRelations</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">turn</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">output</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span>
</code></pre></div>

<h1 id="jtcrouterpy">jtcrouter.py<a class="headerlink" href="#jtcrouterpy" title="Permanent link">#</a></h1>
<p>The <strong>J</strong>unction<strong>T</strong>urn<strong>C</strong>ountRouter generates vehicle routes from turn-count data.
It does so by converting the turn counts into into flows and turn-ratio files that are suitable as <a href="../jtrrouter.html">jtrrouter</a> input.
Then it calls jtrrouter in the background. The turn</p>
<div class="codehilite"><pre><span></span><code><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">jtcrouter</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">net</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">turn</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">output</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span>
</code></pre></div>

<p>There are three basic styles of converting turn-counts to routes:</p>
<ul>
<li>Flows start at all turn-count locations in the network but end when reaching the next count location</li>
<li>Flows start at all turn-count locations in the network and are discounted when reaching the next count location (<strong>--discount-sources</strong>)</li>
<li>Flows only start on the fringe of the network (<strong>--fringe-flows</strong>)</li>
</ul>
<h2 id="turn_count_data_format">Turn count data format<a class="headerlink" href="#turn_count_data_format" title="Permanent link">#</a></h2>
<p>The turn-count data must be provided in the format which is the same as for <a href="#routesamplerpy">routeSampler</a>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;data&gt;</span>
  <span class="nt">&lt;interval</span> <span class="na">id=</span><span class="s">&quot;generated&quot;</span> <span class="na">begin=</span><span class="s">&quot;0.0&quot;</span> <span class="na">end=</span><span class="s">&quot;99.0&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;-58.121.42&quot;</span> <span class="na">to=</span><span class="s">&quot;64&quot;</span> <span class="na">count=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;-58.121.42&quot;</span> <span class="na">to=</span><span class="s">&quot;-31&quot;</span> <span class="na">count=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;45&quot;</span> <span class="na">to=</span><span class="s">&quot;-68&quot;</span> <span class="na">count=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;-31.80.00&quot;</span> <span class="na">to=</span><span class="s">&quot;31&quot;</span> <span class="na">count=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;-31.80.00&quot;</span> <span class="na">to=</span><span class="s">&quot;37&quot;</span> <span class="na">count=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;-31.80.00&quot;</span> <span class="na">to=</span><span class="s">&quot;-23&quot;</span> <span class="na">count=</span><span class="s">&quot;13&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;-92.180.00&quot;</span> <span class="na">to=</span><span class="s">&quot;-60&quot;</span> <span class="na">count=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/interval&gt;</span>
<span class="nt">&lt;/data&gt;</span>
</code></pre></div>
                </div>
          </div>
          <button onclick="goTopFunction()" id="goToTop" title="Go to top"><i class="fa fa-arrow-up"></i></button>
        </div>

        <footer class="col-md-12">
          
            <br><small><i>This page was last edited on: 02 April 2022</i></small>
          
          <hr>
            <p>Copyright &copy; 2001-2022 German Aerospace Center (DLR) and others.</p>
          <p>Follow us on <a class="no-arrow-link" href="https://www.twitter.com/eclipsesumo/"><i class="fa fa-twitter"></i></a> <a class="no-arrow-link" href="https://www.facebook.com/simulationofurbanmobility/"><i class="fa fa-facebook-square"></i></a> <a class="no-arrow-link" href="https://www.instagram.com/eclipse.sumo/"><i class="fa fa-instagram"></i></a>
          | Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a></p>
        </footer>

      <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body" style="color: #495057 !important;">
                <p>Enter your search terms:</p>
                <script async src="https://cse.google.com/cse.js?cx=004302551366764109984:1kpgtzrm6kv"></script>
                <div class="gcse-search"></div>
            </div>
        </div>
    </div>
</div>
      <script>
        window.onscroll = function() {scrollFunction()};
        
        function scrollFunction() {
          if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("goToTop").style.display = "block";
          } else {
            document.getElementById("goToTop").style.display = "none";
          }
        }
    
        function goTopFunction() {
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
        }

        var base_url = "..",
            shortcuts = {"edit": 69, "help": 191, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>

        <script>
          const toggleSwitch = document.querySelector('#theme-switch input[type="checkbox"]');
  
          function switchTheme(e) {
              if (e.target.checked) {
                  localStorage.setItem('sumo-docs-theme', 'dark');
                  document.documentElement.setAttribute('data-theme', 'dark');
                  toggleSwitch.checked = true;
              } else {
                  localStorage.setItem('sumo-docs-theme', 'light');
                  document.documentElement.setAttribute('data-theme', 'light');
                  toggleSwitch.checked = false;
              }    
          }
  
          toggleSwitch.addEventListener('change', switchTheme, false);
  
          if (document.documentElement.getAttribute("data-theme") == "dark"){
              toggleSwitch.checked = true;
          }
          </script>

      <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Key</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody style="color: #495057 !important;">
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>開啟說明對話框</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>搜尋文件</td>
                  </tr>
                  <tr>
                    <td class="edit shortcut"><kbd>e</kbd></td>
                    <td>Edit current page on GitHub</td>
                  </tr>
                </tbody>
              </table>
            </div>
        </div>
    </div>
</div>
    </body>
</html>
