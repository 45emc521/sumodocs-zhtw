<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta property="og:image" content="../images/image-facebook.jpg">
        <meta property="og:image:type" content="image/jpeg">
        <meta property="og:image:width" content="1080">
        <meta property="og:image:height" content="1080">

        
        
        <link rel="canonical" href="https://sumodocs-zhtw.emc521.tw/Demand/Routing_by_Turn_Probabilities.html">
        <link rel="shortcut icon" href="../images/favicon.ico">
        <title>Routing by Turn Probabilities - SUMO 說明文件｜SUMO Documentation (Chinese Traditional)</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="apple-touch-icon" href="../images/apple-touch-icon.png">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 

      <script>
        // DARK MODE
        function detectColorScheme(){
          var theme="light";

          if(localStorage.getItem("sumo-docs-theme")){
              if(localStorage.getItem("sumo-docs-theme") == "dark"){
                  var theme = "dark";
              }
          } else if(!window.matchMedia) {
              return false;
          } else if(window.matchMedia("(prefers-color-scheme: dark)").matches) {
              var theme = "dark";
          }

          if (theme=="dark") {
              document.documentElement.setAttribute("data-theme", "dark");
          }
        }
        detectColorScheme();
      </script>

    </head>

    <body>

        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary text-center">
            <div class="container-fluid">
                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../index.html" class="nav-link">說明文件首頁</a>
                            </li>
                            <li class="navitem">
                                <a href="../Tutorials/index.html" class="nav-link">教學</a>
                            </li>
                            <li class="navitem">
                                <a href="../FAQ.html" class="nav-link">常見問題</a>
                            </li>
                            <li class="navitem">
                                <a href="../Downloads.html" class="nav-link">下載 SUMO</a>
                            </li>
                            <li class="navitem">
                                <a href="../Publications.html" class="nav-link">出版品</a>
                            </li>
                            <li class="navitem">
                                <a href="../Developer/index.html" class="nav-link">開發人員</a>
                            </li>
                            <li class="navitem">
                                <a href="../ChangeLog.html" class="nav-link">版本紀錄</a>
                            </li>
                            <li class="navitem">
                                <a href="https://eclipse.org/sumo/contact/" class="nav-link">聯絡我們</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i>搜尋原文內容
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="edit" href="https://github.com/45EMC521/sumodocs-zhtw/edit/main/docs/Demand/Routing_by_Turn_Probabilities.md" class="nav-link"><i class="fa fa-github"></i>在 GitHub 編輯中文文件</a>
                            </li>
                      <li class="nav-item dropdown">
                          <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            More <i class="fa fa-chevron-circle-down"></i>
                          </a>
                          <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item no-arrow-link" href="https://github.com/45EMC521/sumodocs-zhtw/issues">回報文件錯誤／翻譯錯誤／提供意見</a>
                            <a class="dropdown-item" href="../Editing_Articles.html">有興趣編輯文章嗎？</a>
                            <a class="dropdown-item" href="https://github.com/45EMC521/sumodocs-zhtw/commits/">文件更新紀錄</a>
                            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#mkdocs_keyboard_modal">快速鍵</a>
                            <a class="dropdown-item no-arrow-link" href="https://sumo.dlr.de/sumo_documentation.zip">下載整份文件（原文版本）</a>
                            <a class="dropdown-item no-arrow-link" href="https://github.com/45EMC521/sumodocs-zhtw/archive/refs/heads/main.zip">下載整份文件（正體中文）</a>
                            <span class="dropdown-item" id="dark-mode-div">深色模式<label id="theme-switch" class="theme-switch" for="checkbox_theme">
                              <input type="checkbox" id="checkbox_theme">
                          </label></span>
                          </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container-fluid">
          <div class="row">
                <div class="col-md-3">
                  <div class="text-center"><a href="../index.html" style="display: inline-block; margin-top: 5px;"><img src="../images/sumo-logo.png" class="sumoLogo" alt="SUMO Logo" width="120px"></a></div>
                  
<div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary toc-scroll toc">
        <ul class="nav flex-column bs-sidenav">
            <p style="margin-top:5px; color:#777777;" class="text-center">Contents</p>
            <li class="nav-item main"><a href="#turn_definitions">Turn Definitions</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#automatic_generation_of_turn_definitions" class="nav-link">• Automatic generation of turn definitions</a>
                </li>
            <li class="nav-item main"><a href="#sinks_definitions">Sinks Definitions</a></li>
            <li class="nav-item main"><a href="#flow_definitions">Flow Definitions</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#random_flows" class="nav-link">• Random Flows</a>
                </li>
            <li class="nav-item main"><a href="#overlapping_flows">Overlapping Flows</a></li>
            <li class="nav-item main"><a href="#additional_options">Additional Options</a></li>
        </ul>
    </div>

    <div class="admonition conference" style="position: sticky; margin-top: 20px; margin-bottom:10px;">
        <p>歡迎您造訪 <a href="https://eclipse.org/sumo">eclipse.org/sumo</a>。</p>
        <p><i>SUMO 說明文件正體中文版是基於 SUMO Documentation 原文版於 2022/04/01 快取所翻譯的。如要閱讀最新的文件內容，請至 <a href="https://sumo.dlr.de/docs/">SUMO Documentation</a> 原文版了解詳情。</i></p>
        </div>

</div>
                  <!--  -->
                </div>
                <div class="col-md-9 main-area" role="main">
                   <!-- page.is_homepage seems to be broken in Mkdocs > 1.1.0 -->
                  <ul class="breadcrumbs">
    <script>
        var pagePath = "/Demand/Routing_by_Turn_Probabilities.html";
        var splitUrl = pagePath.split("/");
        splitUrl.pop();
        splitUrl.shift();
        if (splitUrl[0] == 'docs') splitUrl.shift();
        var homeLink = "../index.html";
        document.write('<li class="breadcrumb-item"><a href="' + homeLink + '"><i class="fa fa-home"></i></a></li>');
        var prev = '';
        
        var dirLink = splitUrl.map(function (el) {
        el = prev + el; prev = el + '/'; return el;
        });

        for (i = 0; i < splitUrl.length; i++) {
            document.write("<li class=\"breadcrumb-item\"><a class=\"no-arrow-link\" href=\"../" + dirLink[i] + "\">" + splitUrl[i] + "</a></li>");
        }
    </script>
    <li class="breadcrumb-item active">Routing by Turn Probabilities</li>
</ul>
                  <hTitles>Routing by Turn Probabilities<hr style="border: 0.5px solid #338033; margin-top: 5px !important;"></hTitles>
                  
                  

<p>The <a href="../jtrrouter.html">jtrrouter</a> is a routing applications which
uses flows and turning percentages at junctions as input. The following
parameter must be supplied:</p>
<ul>
<li>the network to route the vehicles through,</li>
<li>the description of the turning ratios for the junctions (defaults
   may be used for this, too), and</li>
<li>the descriptions of the flows.</li>
</ul>
<p>A call may look like this:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">jtrrouter</span> <span class="o">--</span><span class="nv">route</span><span class="o">-</span><span class="nv">files</span><span class="o">=&lt;</span><span class="nv">FLOW_DEFS</span><span class="o">&gt;</span> <span class="o">--</span><span class="nv">turn</span><span class="o">-</span><span class="nv">ratio</span><span class="o">-</span><span class="nv">files</span><span class="o">=&lt;</span><span class="nv">TURN_DEFINITIONS</span><span class="o">&gt;</span> <span class="o">--</span><span class="nv">net</span><span class="o">-</span><span class="nv">file</span><span class="o">=&lt;</span><span class="nv">SUMO_NET</span><span class="o">&gt;</span> \
  <span class="o">--</span><span class="nv">output</span><span class="o">-</span><span class="nv">file</span><span class="o">=</span><span class="nv">MySUMORoutes</span>.<span class="nv">rou</span>.<span class="nv">xml</span> <span class="o">--</span><span class="nv">begin</span> <span class="o">&lt;</span><span class="nv">UINT</span><span class="o">&gt;</span> <span class="o">--</span><span class="k">end</span> <span class="o">&lt;</span><span class="nv">UINT</span><span class="o">&gt;</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When turn-counts instead of turn-ratios are available, <a href="Routes_from_Observation_Points.html">other tools may be used</a>.</p>
</div>
<h2 id="turn_definitions">Turn Definitions<a class="headerlink" href="#turn_definitions" title="Permanent link">#</a></h2>
<table>
<thead>
<tr>
<th>Turn and Sink Definitions</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Filename extension</td>
<td>.turns.xml</td>
</tr>
<tr>
<td>Type of content</td>
<td>turn and sink definitions</td>
</tr>
<tr>
<td>Open format?</td>
<td>Yes</td>
</tr>
<tr>
<td>SUMO specific?</td>
<td>Yes</td>
</tr>
<tr>
<td>XML Schema</td>
<td><a href="http://sumo.dlr.de/xsd/edgerelations_file.xsd">edgerelations_file.xsd</a></td>
</tr>
</tbody>
</table>
<p>To describe the turn definitions, one has to write an XML file. Within
this file, for each interval and each edge the list of percentages to
use a certain follower edge has to be given. An example:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;edgeRelations&gt;</span>
   <span class="nt">&lt;interval</span> <span class="na">begin=</span><span class="s">&quot;0&quot;</span> <span class="na">end=</span><span class="s">&quot;3600&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;myEdge0&quot;</span> <span class="na">to=</span><span class="s">&quot;myEdge1&quot;</span> <span class="na">probability=</span><span class="s">&quot;0.2&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;myEdge0&quot;</span> <span class="na">to=</span><span class="s">&quot;myEdge2&quot;</span> <span class="na">probability=</span><span class="s">&quot;0.7&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;edgeRelation</span> <span class="na">from=</span><span class="s">&quot;myEdge0&quot;</span> <span class="na">to=</span><span class="s">&quot;myEdge3&quot;</span> <span class="na">probability=</span><span class="s">&quot;0.1&quot;</span><span class="nt">/&gt;</span>

      ... any other edges ...

   <span class="nt">&lt;/interval&gt;</span>

   ... some further intervals ...

<span class="nt">&lt;/edgeRelations&gt;</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you provide turn definitions that overlap (for example in multiple files), the latter turn definition will override the former.</p>
</div>
<p>The snippet defines that vehicles coming at the end of edge
"<code>myEdge0</code>" within the time interval between
0s and 3600s will choose the edge "<code>myEdge1</code>"
with a probability of 20%, "<code>myEdge2</code>" with a
probability of 70% and "<code>myEdge3</code>" with a
probability of 10%. Another possibility to save time on preparing the
description is to use default values. The parameter <strong>--turn-defaults (-T) &lt;TURN_DEFAULTS></strong> can be used to
describe the default ratios that will be used for all junctions for all
time steps. &lt;TURN_DEFAULTS> is a list of doubles, separated by a ','. To
achieve the same behavior as in the example above, use <strong>--turn-defaults 20,70,10</strong>. The values
will be applied to an edge's following edges beginning at the right edge
(20%) and ending at the leftmost edge (10%). As the number of possible
followers changes for different edges, the values are resampled for
edges which number of following edges differs from the number of given
turning probability defaults. Given <strong>--turn-defaults 20,70,10</strong> a vehicle using an edge that has
two followers would use the follower to the right with 55% probability,
the one to the left with 45%.</p>
<h3 id="automatic_generation_of_turn_definitions">Automatic generation of turn definitions<a class="headerlink" href="#automatic_generation_of_turn_definitions" title="Permanent link">#</a></h3>
<p>For automatic, yet artificial, turn definitions generation based on the
network structure, see <a href="../Tools/Turns.html#generateturndefspy">generateTurnDefs.py</a>.</p>
<p>You can also generate turn definitions from an existing route file. see <a href="../Tools/Turns.html#generateturnratiospy">generateTurnRatios.py</a>.</p>
<h2 id="sinks_definitions">Sinks Definitions<a class="headerlink" href="#sinks_definitions" title="Permanent link">#</a></h2>
<p>A vehicle leaves the network as soon as it comes to a sink edge. As not
all networks have sink edges defined, one can support a list of edges to
be declared as sinks using <strong>--sinks &lt;EDGE_ID>[,&lt;EDGE_ID>]</strong>*. You may also add your sink definitions to a
turn-file (XML only):</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;turns&gt;</span>
   ... some further turning definitions as above ...

   <span class="nt">&lt;sink</span> <span class="na">edges=</span><span class="s">&quot;&lt;EDGE_ID&gt;[ &lt;EDGE_ID&gt;]*&quot;</span><span class="nt">/&gt;</span>
   ... further sink definitions ...

<span class="nt">&lt;/turns&gt;</span>
</code></pre></div>

<p>If you do not define sinks, the option <strong>--accept-all-destinations</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;BOOL&gt;</em></a> may be used to declare all edge
as possible sinks.</p>
<h2 id="flow_definitions">Flow Definitions<a class="headerlink" href="#flow_definitions" title="Permanent link">#</a></h2>
<p>The <a href="../Definition_of_Vehicles%2C_Vehicle_Types%2C_and_Routes.html#repeated_vehicles_flows">definitions of the
flow</a>
is the same as for the <a href="../duarouter.html">duarouter</a> with just a
single difference: as it is not known where the vehicle will leave the
network as the route it uses is randomly computed, the route must be
specified using attribute <em>from</em> and attribute <em>to</em> must be omitted:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;routes&gt;</span>
   <span class="nt">&lt;flow</span> <span class="na">id=</span><span class="s">&quot;example0&quot;</span> <span class="na">from=</span><span class="s">&quot;A&quot;</span> <span class="na">begin=</span><span class="s">&quot;0&quot;</span> <span class="na">end=</span><span class="s">&quot;3600&quot;</span> <span class="na">probability=</span><span class="s">&quot;0.5&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;flow</span> <span class="na">id=</span><span class="s">&quot;example1&quot;</span> <span class="err">...</span> <span class="nt">/&gt;</span>
   ....
<span class="nt">&lt;/routes&gt;</span>
</code></pre></div>

<h3 id="random_flows">Random Flows<a class="headerlink" href="#random_flows" title="Permanent link">#</a></h3>
<p>The tool <a href="../Tools/Trip.html#randomtripspy">randomTrips.py</a> can be
used to generated jtrrouter input by setting options <strong>--flows</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;INT&gt;</em></a> <strong>--jtrrouter</strong>.</p>
<h2 id="overlapping_flows">Overlapping Flows<a class="headerlink" href="#overlapping_flows" title="Permanent link">#</a></h2>
<p>By default JTRRouter will route flows through the network and split them at intersections until each part of the flow has reached a sink edge. When such a flow reaches the source edge of another flow, the total traffic is added.
The following options can change this behavior:</p>
<ul>
<li><strong>--sources-are-sinks</strong> (shortcut <strong>-S</strong>). When this option is set, all flows will terminate upon reaching the from-edge of another flow. Issue <a class="gh-link gh-issue" href="https://github.com/eclipse/sumo/issues/6601" title="GitHub Issue eclipse/sumo #6601">#6601</a></li>
<li><strong>--discount-sources</strong> (shortcut <strong>-D</strong>). When this option is set, the flow departing at an edge will be reduced by the amount of traffic that has reached this edge from upstream flows. When combined with option <strong>--sources-are-sinks</strong>, upstream flows will terminate at a downstream edge when the source flow number has been reached.</li>
</ul>
<h2 id="additional_options">Additional Options<a class="headerlink" href="#additional_options" title="Permanent link">#</a></h2>
<p>As theoretically a route may get infinitely long when a vehicle is
forced to take always the same direction, it is possible to limit the
route's size using option <strong>--max-edges-factor</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FLOAT&gt;</em></a>. This factor, multiplied with the number of
the used network's edges is the maximum number of edges a route may
have. With the default of 2.0, a route may contain twice as many edges
as the network has. Any route longer than this size will be marked as
invalid. We assume that for each network this number has to be chosen
again.</p>
                </div>
          </div>
          <button onclick="goTopFunction()" id="goToTop" title="Go to top"><i class="fa fa-arrow-up"></i></button>
        </div>

        <footer class="col-md-12">
          
            <br><small><i>本頁面最近更新日期：02 April 2022</i></small>
          
          <hr>
            <p>Copyright &copy; 2001-2022 德國航空太空中心 (DLR) 和其他貢獻者｜中文翻譯由 Yu-Hsuan Liao 及其他貢獻者維護</p>
          <p>在這些地方追蹤我們：<a class="no-arrow-link" href="https://www.twitter.com/eclipsesumo/"><i class="fa fa-twitter"></i></a> <a class="no-arrow-link" href="https://www.facebook.com/simulationofurbanmobility/"><i class="fa fa-facebook-square"></i></a> <a class="no-arrow-link" href="https://www.instagram.com/eclipse.sumo/"><i class="fa fa-instagram"></i></a>
          ｜本說明文件由 <a href="https://www.mkdocs.org/">MkDocs</a></p> 提供支援。
        </footer>

      <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">搜尋</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">關閉</span></button>
            </div>
            <div class="modal-body" style="color: #495057 !important;">
                <p>Enter your search terms:</p>
                <script async src="https://cse.google.com/cse.js?cx=004302551366764109984:1kpgtzrm6kv"></script>
                <div class="gcse-search"></div>
            </div>
        </div>
    </div>
</div>
      <script>
        window.onscroll = function() {scrollFunction()};
        
        function scrollFunction() {
          if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("goToTop").style.display = "block";
          } else {
            document.getElementById("goToTop").style.display = "none";
          }
        }
    
        function goTopFunction() {
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
        }

        var base_url = "..",
            shortcuts = {"edit": 69, "help": 191, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>

        <script>
          const toggleSwitch = document.querySelector('#theme-switch input[type="checkbox"]');
  
          function switchTheme(e) {
              if (e.target.checked) {
                  localStorage.setItem('sumo-docs-theme', 'dark');
                  document.documentElement.setAttribute('data-theme', 'dark');
                  toggleSwitch.checked = true;
              } else {
                  localStorage.setItem('sumo-docs-theme', 'light');
                  document.documentElement.setAttribute('data-theme', 'light');
                  toggleSwitch.checked = false;
              }    
          }
  
          toggleSwitch.addEventListener('change', switchTheme, false);
  
          if (document.documentElement.getAttribute("data-theme") == "dark"){
              toggleSwitch.checked = true;
          }
          </script>

      <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Key</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody style="color: #495057 !important;">
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>開啟快速鍵列表</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>搜尋文件</td>
                  </tr>
                  <tr>
                    <td class="edit shortcut"><kbd>e</kbd></td>
                    <td>在 GitHub 上編輯本頁</td>
                  </tr>
                </tbody>
              </table>
            </div>
        </div>
    </div>
</div>
    </body>
</html>
