<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta property="og:image" content="../images/image-facebook.jpg">
        <meta property="og:image:type" content="image/jpeg">
        <meta property="og:image:width" content="1080">
        <meta property="og:image:height" content="1080">

        
        
        <link rel="canonical" href="https://sumodocs-zhtw.emc521.tw/Simulation/Traffic_Lights.html">
        <link rel="shortcut icon" href="../images/favicon.ico">
        <title>Traffic Lights - SUMO 說明文件｜SUMO Documentation (Chinese Traditional)</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="apple-touch-icon" href="../images/apple-touch-icon.png">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../stylesheets/extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 

      <script>
        // DARK MODE
        function detectColorScheme(){
          var theme="light";

          if(localStorage.getItem("sumo-docs-theme")){
              if(localStorage.getItem("sumo-docs-theme") == "dark"){
                  var theme = "dark";
              }
          } else if(!window.matchMedia) {
              return false;
          } else if(window.matchMedia("(prefers-color-scheme: dark)").matches) {
              var theme = "dark";
          }

          if (theme=="dark") {
              document.documentElement.setAttribute("data-theme", "dark");
          }
        }
        detectColorScheme();
      </script>

    </head>

    <body>

        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary text-center">
            <div class="container-fluid">
                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../index.html" class="nav-link">說明文件首頁</a>
                            </li>
                            <li class="navitem">
                                <a href="../Tutorials/index.html" class="nav-link">教學</a>
                            </li>
                            <li class="navitem">
                                <a href="../FAQ.html" class="nav-link">常見問題</a>
                            </li>
                            <li class="navitem">
                                <a href="../Downloads.html" class="nav-link">下載 SUMO</a>
                            </li>
                            <li class="navitem">
                                <a href="../Publications.html" class="nav-link">出版品</a>
                            </li>
                            <li class="navitem">
                                <a href="../Developer/index.html" class="nav-link">開發人員</a>
                            </li>
                            <li class="navitem">
                                <a href="../ChangeLog.html" class="nav-link">版本紀錄</a>
                            </li>
                            <li class="navitem">
                                <a href="https://eclipse.org/sumo/contact/" class="nav-link">聯絡我們</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i>搜尋原文內容
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="edit" href="https://github.com/45EMC521/sumodocs-zhtw/edit/main/docs/Simulation/Traffic_Lights.md" class="nav-link"><i class="fa fa-github"></i>在 GitHub 編輯中文文件</a>
                            </li>
                      <li class="nav-item dropdown">
                          <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            More <i class="fa fa-chevron-circle-down"></i>
                          </a>
                          <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item no-arrow-link" href="https://github.com/45EMC521/sumodocs-zhtw/issues">回報文件錯誤／翻譯錯誤／提供意見</a>
                            <a class="dropdown-item" href="../Editing_Articles.html">有興趣編輯文章嗎？</a>
                            <a class="dropdown-item" href="https://github.com/45EMC521/sumodocs-zhtw/commits/">文件更新紀錄</a>
                            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#mkdocs_keyboard_modal">快速鍵</a>
                            <a class="dropdown-item no-arrow-link" href="https://sumo.dlr.de/sumo_documentation.zip">下載整份文件（原文版本）</a>
                            <a class="dropdown-item no-arrow-link" href="https://github.com/45EMC521/sumodocs-zhtw/archive/refs/heads/main.zip">下載整份文件（正體中文）</a>
                            <span class="dropdown-item" id="dark-mode-div">深色模式<label id="theme-switch" class="theme-switch" for="checkbox_theme">
                              <input type="checkbox" id="checkbox_theme">
                          </label></span>
                          </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container-fluid">
          <div class="row">
                <div class="col-md-3">
                  <div class="text-center"><a href="../index.html" style="display: inline-block; margin-top: 5px;"><img src="../images/sumo-logo.png" class="sumoLogo" alt="SUMO Logo" width="120px"></a></div>
                  
<div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary toc-scroll toc">
        <ul class="nav flex-column bs-sidenav">
            <p style="margin-top:5px; color:#777777;" class="text-center">Contents</p>
            <li class="nav-item main"><a href="#automatically_generated_tls-programs">Automatically Generated TLS-Programs</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#default_4-arm_intersection_layout_opposites" class="nav-link">• Default 4-arm intersection (layout opposites)</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#intersection_layout_incoming" class="nav-link">• Intersection layout incoming</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#intersection_layout_alternateoneway" class="nav-link">• Intersection layout alternateOneWay</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#other_intersections" class="nav-link">• Other Intersections</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#improving_generated_programs_with_knowledge_about_traffic_demand" class="nav-link">• Improving Generated programs with knowledge about traffic demand</a>
                </li>
            <li class="nav-item main"><a href="#defining_new_tls-programs">Defining New TLS-Programs</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#tllogic_attributes" class="nav-link">• &lt;tlLogic> Attributes</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#phase_attributes" class="nav-link">• &lt;phase> Attributes</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#signal_state_definitions" class="nav-link">• Signal state definitions</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#default_link_indices" class="nav-link">&rarr; Default link indices</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#accessing_indices_programmatically" class="nav-link">&rarr; Accessing indices programmatically</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#viewing_tls-programs_graphically" class="nav-link">• Viewing TLS-Programs graphically</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#interaction_between_signal_plans_and_right-of-way_rules" class="nav-link">• Interaction between signal plans and right-of-way rules</a>
                </li>
            <li class="nav-item main"><a href="#traffic_lights_that_respond_to_traffic">Traffic Lights that respond to traffic</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#type_actuated" class="nav-link">• Type 'actuated'</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#detectors" class="nav-link">&rarr; Detectors</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#example" class="nav-link">&rarr; Example</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#parameters" class="nav-link">&rarr; Parameters</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#visualization" class="nav-link">&rarr; Visualization</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#custom_detectors" class="nav-link">&rarr; Custom Detectors</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#lane-specific_max-gap" class="nav-link">&rarr; Lane-specific max-gap</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#coordination" class="nav-link">&rarr; Coordination</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#dynamic_phase_selection_phase_skipping" class="nav-link">&rarr; Dynamic Phase Selection (Phase Skipping)</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#type_actuated_with_custom_switching_rules" class="nav-link">• Type 'actuated' with custom switching rules</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#named_expressions" class="nav-link">&rarr; Named Expressions</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#examples" class="nav-link">&rarr; Examples</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#overriding_phase_attributes_with_expressions" class="nav-link">&rarr; Overriding Phase Attributes with Expressions</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#storing_and_modifying_custom_data" class="nav-link">&rarr; Storing and modifying custom data</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#custom_function_definitions" class="nav-link">&rarr; Custom function definitions</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#type_delay_based" class="nav-link">• Type 'delay_based'</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#custom_detectors_1" class="nav-link">&rarr; Custom Detectors</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#type_nema" class="nav-link">• Type 'NEMA'</a>
                </li>
                <li class="nav-item" style="text-indent: 25px;">
                    <a href="#custom_detectors_2" class="nav-link">&rarr; Custom Detectors</a>
                </li>
            <li class="nav-item main"><a href="#loading_a_new_program">Loading a new Program</a></li>
            <li class="nav-item main"><a href="#tools_for_importing_tls_programs">Tools for Importing TLS Programs</a></li>
            <li class="nav-item main"><a href="#modifying_existing_tls-programs">Modifying Existing TLS-Programs</a></li>
            <li class="nav-item main"><a href="#controlling_multiple_junctions_with_the_same_controller">Controlling multiple Junctions with the same controller</a></li>
            <li class="nav-item main"><a href="#defining_signal_groups">Defining Signal Groups</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#automatic_creation_of_signal_groups" class="nav-link">• Automatic Creation of Signal Groups</a>
                </li>
            <li class="nav-item main"><a href="#defining_program_switch_times_and_procedure">Defining Program Switch Times and Procedure</a></li>
            <li class="nav-item main"><a href="#evaluation_of_traffic_lights_performance">Evaluation of Traffic Lights Performance</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#tools_for_automatic_detector_generation" class="nav-link">• Tools For Automatic Detector Generation</a>
                </li>
            <li class="nav-item main"><a href="#controlling_traffic_lights_via_traci">Controlling traffic lights via TraCI</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#setting_the_phase" class="nav-link">• Setting the phase</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#setting_the_duration" class="nav-link">• Setting the duration</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#setting_the_state" class="nav-link">• Setting the state</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#setting_the_complete_program" class="nav-link">• Setting the complete Program</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#switching_between_pre-defined_programs" class="nav-link">• Switching between pre-defined Programs</a>
                </li>
            <li class="nav-item main"><a href="#signal_plan_visualization">Signal Plan Visualization</a></li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#show_phases" class="nav-link">• Show Phases</a>
                </li>
                <li class="nav-item" style="text-indent: 5px;">
                    <a href="#track_phases" class="nav-link">• Track Phases</a>
                </li>
        </ul>
    </div>

    <div class="admonition conference" style="position: sticky; margin-top: 20px; margin-bottom:10px;">
        <p>歡迎您造訪 <a href="https://eclipse.org/sumo">eclipse.org/sumo</a>。</p>
        <p>SUMO 說明文件正體中文版是基於 SUMO Documentation 原文版於 2022/04/01 快取所翻譯的。如要閱讀最新的文件內容，請至 <a href="https://sumo.dlr.de/docs/">SUMO Documentation</a> 原文版了解詳情。</p>
        </div>

</div>
                  <!--  -->
                </div>
                <div class="col-md-9 main-area" role="main">
                   <!-- page.is_homepage seems to be broken in Mkdocs > 1.1.0 -->
                  <ul class="breadcrumbs">
    <script>
        var pagePath = "/Simulation/Traffic_Lights.html";
        var splitUrl = pagePath.split("/");
        splitUrl.pop();
        splitUrl.shift();
        if (splitUrl[0] == 'docs') splitUrl.shift();
        var homeLink = "../index.html";
        document.write('<li class="breadcrumb-item"><a href="' + homeLink + '"><i class="fa fa-home"></i></a></li>');
        var prev = '';
        
        var dirLink = splitUrl.map(function (el) {
        el = prev + el; prev = el + '/'; return el;
        });

        for (i = 0; i < splitUrl.length; i++) {
            document.write("<li class=\"breadcrumb-item\"><a class=\"no-arrow-link\" href=\"../" + dirLink[i] + "\">" + splitUrl[i] + "</a></li>");
        }
    </script>
    <li class="breadcrumb-item active">Traffic Lights</li>
</ul>
                  <hTitles>Traffic Lights<hr style="border: 0.5px solid #338033; margin-top: 5px !important;"></hTitles>
                  
                  

<p>Normally, <a href="../netconvert.html">netconvert</a> and
<a href="../netgenerate.html">netgenerate</a> generate traffic lights and
programs for junctions during the computation of the networks. Still,
these computed programs quite often differ from those found in reality.
To feed the simulation with real traffic light programs, it is possible
to run <a href="../sumo.html">sumo</a>/<a href="../sumo-gui.html">sumo-gui</a> with
additional program definitions. Also,
<a href="../sumo.html">sumo</a>/<a href="../sumo-gui.html">sumo-gui</a> allow loading
definitions which describe when and how a set of traffic lights can
switch from one program to another. Both will be discussed in the
following subchapters. Another possibility is to edit traffic light plans
visually in <a href="../Netedit/index.html#traffic_lights">netedit</a>.</p>
<h1 id="automatically_generated_tls-programs">Automatically Generated TLS-Programs<a class="headerlink" href="#automatically_generated_tls-programs" title="Permanent link">#</a></h1>
<ul>
<li>By default, all traffic lights are generated with a fixed cycle and a
  cycle time of 90s. This can be changed with the option <strong>--tls.cycle.time</strong>. 
  The <a href="../Tutorials/OSMWebWizard.html">osmWebWizard</a> generates <em>actuated</em> traffic lights by default (see below).</li>
<li>The green time is split equally between the main phases</li>
<li>All green phases are followed by a yellow phase. The length of the
  yellow phase is computed from the maximum speed of the incoming
  roads but may be customized with the option <strong>--tls.yellow.time</strong></li>
<li>If the speeds at the intersection are below the threshold of 70km/h
  (configurable via option <strong>tls.minor-left.max-speed</strong>), left-turns are allowed at the same time
  as oncoming straight traffic but have to yield. This is called
  <em>green minor</em> and indicated with a lower-case <strong>g</strong> in the state
  definition. Otherwise, the left-turning stream must use a protected
  left-turn phase (see below). If no such phase can be built because
  there is no dedicated turning lane, <em>green minor</em> is allowed anyway
  but a warning is issued.</li>
<li>If a green phase allows for partially conflicting streams (i.e.
  straight going and left-turning from the opposite direction) and
  there is a dedicated turning lane, it is succeeded by another green
  phase with full priority to the partially conflicted streams (this
  would typically be a left-turning phase). The duration of this phase
  defaults to 6s and can be customized (or disabled) by setting the
  option <strong>--tls.left-green.time</strong>.</li>
<li>The generated cycle starts at time 0 by default with a green phase for the first main direction 
  (sorted by road priority, lane count and speed). This can be influenced for a specified list of traffic light ids using the options <strong>--tls.half-offset TLS1,TLS2,..</strong> and <strong>--tls.quarter-offset TLS3,TLS4,...</strong>. (shifting the start of the first phase by the indicated fraction of the cycle time).</li>
<li>In reality there are often phases where all streams have red to
  allow clearing an intersection. SUMO does not build these phases by
  default. To have each green phase preceded by an all-red phase, the
  option <strong>--tls.allred.time</strong> can be used.</li>
<li>It is also possible to generate
  <a href="#actuated_traffic_lights">#Actuated_Traffic_Lights</a>
  by setting the option <strong>--tls.default-type</strong>. This will generated the same signal plans as
  above but with green phases that have a variable length of 5s-50s
  (both values can be set using the options <strong>--tls.min-dur, --tls.max-dur</strong>).
    - default type <strong>actuated</strong>: traffic light actuation is based on gaps measured by automatically generated induction loops
    - default type <strong>delay_based</strong>: actuation is based on vehicle delays</li>
<li>The generated phase layout can be selected setting option <strong>--tls.layout</strong> to
  <em>opposites</em> (default) or <em>incoming</em> (see below).</li>
<li>The generated phase layout is also influenced by the <a href="../Networks/PlainXML.html#node_types">node
  type</a> which may be either
  <em>traffic_light</em> or <em>traffic_light_right_on_red</em> (explained
  below)</li>
</ul>
<h2 id="default_4-arm_intersection_layout_opposites">Default 4-arm intersection (layout <em>opposites</em>)<a class="headerlink" href="#default_4-arm_intersection_layout_opposites" title="Permanent link">#</a></h2>
<p>By default, programs are generated with 4 green phases:</p>
<ol>
<li>a straight phase</li>
<li>a left-turning phase (only if there is a dedicated left-turn lane)</li>
<li>a straight phase for the direction orthogonal to the first one</li>
<li>a left-turning phase for the direction direction orthogonal to the
    first one (only if there is a dedicated left-turn lane)</li>
</ol>
<p>Due to the default timings explained above, the green phases usually
have a duration of 31s.</p>
<p>If the node type is set to <em>traffic_light_right_on_red</em> rather than
<em>traffic_light</em>, then right turns from all sides are permitted in all
phases (after coming to a stop before entering the traffic stream that
currently has the green light.</p>
<h2 id="intersection_layout_incoming">Intersection layout <em>incoming</em><a class="headerlink" href="#intersection_layout_incoming" title="Permanent link">#</a></h2>
<ul>
<li>each incoming edge of the intersection gets a separate green phase
where all directions of movement are allowed</li>
<li>If the node type is set to <em>traffic_light_right_on_red</em> rather
than <em>traffic_light</em>, then compatible right-turns are allowed
simultaneously</li>
</ul>
<h2 id="intersection_layout_alternateoneway">Intersection layout <em>alternateOneWay</em><a class="headerlink" href="#intersection_layout_alternateoneway" title="Permanent link">#</a></h2>
<p>This layout can be used to model alternating access to a road section which can only be used by one direction at a time.
To make use of this layout, a <a href="#controlling_multiple_junctions_with_the_same_controller">joint traffic light</a> must be defined for all junctions that border the restricted section. Alternating green phases are separated by an all-red phase that is long enough to clear the interior section.</p>
<h2 id="other_intersections">Other Intersections<a class="headerlink" href="#other_intersections" title="Permanent link">#</a></h2>
<ul>
<li>If there are more than 4 roads meeting at an intersection,
additional green phases are generated</li>
<li>If the roads meeting at an intersection have the highest road
priorities on a turning stream, then layout <em>incoming</em> may be
generated instead of layout <em>opposites</em>.</li>
<li>If a traffic-light junction does not have any conflicting roads
(i.e. it models a pedestrian crossing) it will not get a red phase
by default. A single red phase may be generated by setting the
option <strong>--tls.red.time</strong>.</li>
</ul>
<h2 id="improving_generated_programs_with_knowledge_about_traffic_demand">Improving Generated programs with knowledge about traffic demand<a class="headerlink" href="#improving_generated_programs_with_knowledge_about_traffic_demand" title="Permanent link">#</a></h2>
<ul>
<li>To get traffic lights that adapt to demand dynamically, built the
network with option <strong>--tls.default-type actuated</strong>. This will automatically generate <a href="#actuated_traffic_lights">actuated
traffic lights</a>. To convert an
existing .net.xml file so that all traffic lights are actuated,
perform the following steps:<ul>
<li>netconvert -s orig.net.xml --plain-output-prefix plain</li>
<li>netconvert -e plain.edg.xml -n plain.nod.xml -x plain.con.xml -o
  updated.net.xml --ignore-errors.edge-type --tls.default-type
  actuated</li>
</ul>
</li>
<li>The tool
<a href="../Tools/tls.html#tlscycleadaptationpy">tlsCycleAdaptation.py</a>
can be used to modify green phase durations to accommodate a given
traffic demand.</li>
<li>The tool <a href="../Tools/tls.html#tlscoordinatorpy">tlsCoordinator.py</a>
can be used to modify program offsets to generated green waves for a
given traffic demand.</li>
</ul>
<h1 id="defining_new_tls-programs">Defining New TLS-Programs<a class="headerlink" href="#defining_new_tls-programs" title="Permanent link">#</a></h1>
<p>You can load new definitions for traffic lights as a part of an <a href="/docs/sumo.html#format_of_additional_files"><em>additional-file</em></a>. When
loaded, the last program will be used. Switching between programs is
possible via WAUTs and/or TraCI. Also, one can switch between them using
the GUI context menu. A definition of a traffic light program within an <a href="/docs/sumo.html#format_of_additional_files"><em>additional-file</em></a>
looks like this:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;additional&gt;</span>
  <span class="nt">&lt;tlLogic</span> <span class="na">id=</span><span class="s">&quot;0&quot;</span> <span class="na">programID=</span><span class="s">&quot;my_program&quot;</span> <span class="na">offset=</span><span class="s">&quot;0&quot;</span> <span class="na">type=</span><span class="s">&quot;static&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;31&quot;</span> <span class="na">state=</span><span class="s">&quot;GGggrrrrGGggrrrr&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;5&quot;</span>  <span class="na">state=</span><span class="s">&quot;yyggrrrryyggrrrr&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;6&quot;</span>  <span class="na">state=</span><span class="s">&quot;rrGGrrrrrrGGrrrr&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;5&quot;</span>  <span class="na">state=</span><span class="s">&quot;rryyrrrrrryyrrrr&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;31&quot;</span> <span class="na">state=</span><span class="s">&quot;rrrrGGggrrrrGGgg&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;5&quot;</span>  <span class="na">state=</span><span class="s">&quot;rrrryyggrrrryygg&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;6&quot;</span>  <span class="na">state=</span><span class="s">&quot;rrrrrrGGrrrrrrGG&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;5&quot;</span>  <span class="na">state=</span><span class="s">&quot;rrrrrryyrrrrrryy&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/tlLogic&gt;</span>
<span class="nt">&lt;/additional&gt;</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To get started you can copy the <strong>tlLogic</strong> elements for all traffic lights you wish to edit from a .net.xml file and put them into a new file. Then you only need to change the programID attribute and the program is ready to be modified and loaded</p>
</div>
<h2 id="tllogic_attributes">&lt;tlLogic> Attributes<a class="headerlink" href="#tllogic_attributes" title="Permanent link">#</a></h2>
<p>The following attributes/elements are used within the tlLogic element:</p>
<table>
<thead>
<tr>
<th>Attribute Name</th>
<th>Value Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>id</strong></td>
<td>id (string)</td>
<td>The id of the traffic light. This must be an existing traffic light id in the .net.xml file. Typically the id for a traffic light is identical with the junction id. The name may be obtained by right-clicking the red/green bars in front of a controlled intersection.</td>
</tr>
<tr>
<td><strong>type</strong></td>
<td>enum (static, actuated, delay_based)</td>
<td>The type of the traffic light (fixed phase durations, phase prolongation based on time gaps between vehicles (actuated), or on accumulated time loss of queued vehicles (delay_based) )</td>
</tr>
<tr>
<td><strong>programID</strong></td>
<td>id (string)</td>
<td>The id of the traffic light program; This must be a new program name for the traffic light id. Please note that "off" is reserved, see below.</td>
</tr>
<tr>
<td><strong>offset</strong></td>
<td>int</td>
<td>The initial time offset of the program</td>
</tr>
</tbody>
</table>
<h2 id="phase_attributes">&lt;phase> Attributes<a class="headerlink" href="#phase_attributes" title="Permanent link">#</a></h2>
<p>Each phase is defined using the following attributes:</p>
<table>
<thead>
<tr>
<th>Attribute Name</th>
<th>Value Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>duration</strong></td>
<td>time (int)</td>
<td>The duration of the phase</td>
</tr>
<tr>
<td><strong>state</strong></td>
<td>list of signal states</td>
<td>The traffic light states for this phase, see below</td>
</tr>
<tr>
<td>minDur</td>
<td>time (int)</td>
<td>The minimum duration of the phase when using type <strong>actuated</strong>. Optional, defaults to duration.</td>
</tr>
<tr>
<td>maxDur</td>
<td>time (int)</td>
<td>The maximum duration of the phase when using type <strong>actuated</strong>. Optional, if minDur is not set it defaults to duration , otherwise to 2147483.</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>An optional description for the phase. This can be used to establish the correspondence between SUMO-phase-indexing and traffic engineering phase names.</td>
</tr>
<tr>
<td>next</td>
<td>list of phase indices (int ...)</td>
<td>The next phase in the cycle after the current. This is useful when adding extra transition phases to a traffic light plan which are not part of every cycle. Traffic lights of type 'actuated' can make use of a list of indices for selecting among alternative successor phases.</td>
</tr>
</tbody>
</table>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>In a SUMO-TLS definition, time is on the vertical axis and each phase describes all signal states that last for a fixed duration. This differs from typical traffic engineering diagrams where time is on the horizontal axis and each row describes the states for one signal. Another crucial difference is, that in SUMO a new phase is introduced whenever at least one signal changes its state. This means that transitions between green phases can be made up of multiple intermediate phases.</p>
</div>
<h2 id="signal_state_definitions">Signal state definitions<a class="headerlink" href="#signal_state_definitions" title="Permanent link">#</a></h2>
<p>Each character within a phase's state describes the state of one signal
of the traffic light. Please note, that a single lane may contain
several signals - for example one for vehicles turning left and one for
vehicles which move straight. This means that a signal does not control
lanes, but links - each connecting a lane which is incoming into a
junction and one which is outgoing from this junction. In SUMO, a
one-to-n dependency between signals and links is implemented, this means
each signal may control more than a single link - though networks
generated by <a href="../netconvert.html">netconvert</a> or
<a href="../netgenerate.html">netgenerate</a> usually use one signal per link.
Please note also, that a traffic light may control lanes incoming into
different junctions. The information about which link is controlled by
which traffic light signal may be obtained using the "show link tls
index" option within <a href="../sumo-gui.html">sumo-gui</a>'s visualization
settings or from the according <code>linkIndex</code>
attribute of the <code>&lt;connection&gt;</code> elements in the <em>.net.xml</em> file.</p>
<p>The following signal colors are used:</p>
<table>
<thead>
<tr>
<th>Character</th>
<th>GUI Color</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td><span style="color:#FF0000; background:#FF0000">FOO</span></td>
<td>'red light' for a signal - vehicles must stop</td>
</tr>
<tr>
<td>y</td>
<td><span style="color:#FFFF00; background:#FFFF00">FOO</span></td>
<td>'amber (yellow) light' for a signal - vehicles will start to decelerate if far away from the junction, otherwise they pass</td>
</tr>
<tr>
<td>g</td>
<td><span style="color:#00B300; background:#00B300">FOO</span></td>
<td>'green light' for a signal, no priority - vehicles may pass the junction if no vehicle uses a higher priorised foe stream, otherwise they decelerate for letting it pass. They always decelerate on approach until they are within the configured <a href="../Networks/PlainXML.html#explicitly_setting_which_edge_lane_is_connected_to_which">visibility distance</a></td>
</tr>
<tr>
<td>G</td>
<td><span style="color:#00FF00; background:#00FF00">FOO</span></td>
<td>'green light' for a signal, priority - vehicles may pass the junction</td>
</tr>
<tr>
<td>s</td>
<td><span style="color:#800080; background:#800080">FOO</span></td>
<td>'green right-turn arrow' requires stopping - vehicles may pass the junction if no vehicle uses a higher priorised foe stream. They always stop before passing. This is only generated for junction type <em>traffic_light_right_on_red</em>.</td>
</tr>
<tr>
<td>u</td>
<td><span style="color:#FF8000; background:#FF8000">FOO</span></td>
<td>'red+yellow light' for a signal, may be used to indicate upcoming green phase but vehicles may not drive yet (shown as orange in the gui)</td>
</tr>
<tr>
<td>o</td>
<td><span style="color:#804000; background:#804000">FOO</span></td>
<td>'off - blinking' signal is switched off, blinking light indicates vehicles have to yield</td>
</tr>
<tr>
<td>O</td>
<td><span style="color:#00FFFF; background:#00FFFF">FOO</span></td>
<td>'off - no signal' signal is switched off, vehicles have the right of way</td>
</tr>
</tbody>
</table>
<p><img alt="traci_tutorial_tls.png" src="../images/Traci_tutorial_tls.png" title="traci_tutorial_tls.png" /></p>
<p>Example: traffic light with the current state
<strong>"GrGr"</strong>. The leftmost letter "G" encodes the green light for link 0,
followed by red for link 1, green for link 2 and red for link 3. The
link numbers are enabled via <a href="../sumo-gui.html">sumo-gui settings</a> by
activating <em>show link tls index</em>.</p>
<h3 id="default_link_indices">Default link indices<a class="headerlink" href="#default_link_indices" title="Permanent link">#</a></h3>
<p>For traffic lights that control a single intersection, the default
<a href="../Networks/SUMO_Road_Networks.html#indices_of_a_connection">indices generated generated by
netconvert</a>
are numbered in a clockwise pattern starting with 0 at 12 o'clock with
right-turns ordered before straight connections and left turns.
<a href="../Networks/PlainXML.html#pedestrian_crossings">Pedestrian
crossings</a> are always
assigned at the very end, also in a clockwise manner.</p>
<p>If traffic lights are joined so that a single program controls multiple
intersections, the ordering for each intersection stays the same but the
indices are increased according the order of the controlled junctions in
the input file.</p>
<h3 id="accessing_indices_programmatically">Accessing indices programmatically<a class="headerlink" href="#accessing_indices_programmatically" title="Permanent link">#</a></h3>
<p>TLS Link indices can be access using either</p>
<ul>
<li><a href="../Tools/Sumolib.html">sumolib</a> using
  <a href="http://sumo.dlr.de/daily/pydoc/sumolib.net.html#TLS">tls.getConnections()</a></li>
<li>or <a href="../TraCI.html">TraCI</a> using
  <a href="../TraCI/Traffic_Lights_Value_Retrieval.html#structure_of_compound_object_controlled_links">traci.trafficlight.getControlledLinks()</a></li>
</ul>
<h2 id="viewing_tls-programs_graphically">Viewing TLS-Programs graphically<a class="headerlink" href="#viewing_tls-programs_graphically" title="Permanent link">#</a></h2>
<p>In the sumo-gui you can right-click on a red/green stop bar and select <em>show
phases</em>.</p>
<h2 id="interaction_between_signal_plans_and_right-of-way_rules">Interaction between signal plans and right-of-way rules<a class="headerlink" href="#interaction_between_signal_plans_and_right-of-way_rules" title="Permanent link">#</a></h2>
<p>Every traffic light intersection has the right-of-way rules of a
priority intersection underneath of it. This becomes obvious when
switching a traffic light off (either in <a href="../sumo-gui.html">sumo-gui</a>
with a right-click on the traffic light or by <a href="#loading_a_new_program">loading the "off"
program</a>).</p>
<p>The right-of-way rules of this priority intersection come into play when
defining signal plans with simultaneous conflicting green streams (by
using <em>g</em> and <em>G</em> states). These signal plans only work correctly if the
right-of-way rules force vehicles from the <em>g</em> stream to yield to the
<em>G</em> stream. In most cases, this relationship was set correctly by the
default signal plan.</p>
<p>However, when introducing new <em>g</em>/<em>G</em> relationships, correctness is only
ensured by loading the network and the new signal plan into
<a href="../netconvert.html">netconvert</a> and thus updating the right-of-way
rules.</p>
<h1 id="traffic_lights_that_respond_to_traffic">Traffic Lights that respond to traffic<a class="headerlink" href="#traffic_lights_that_respond_to_traffic" title="Permanent link">#</a></h1>
<p>Generally, the designation "actuated" refers to traffic lights that switch in response to traffic (or lack thereof). The different controllers and their features are described below. SUMO supports several algorithms with this property and they are described below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a href="Meso.html">Mesoscopic simulation</a> does not support actuated traffic lights.</p>
</div>
<h2 id="type_actuated">Type 'actuated'<a class="headerlink" href="#type_actuated" title="Permanent link">#</a></h2>
<p>SUMO supports <em>gap-based</em> actuated traffic control. This control scheme
is common in Germany and works by prolonging traffic phases whenever a
continuous stream of traffic is detected. It switches to the next phase
after detecting a sufficient time gap between successive vehicles. This
allows for better distribution of green-time among phases and also
affects cycle duration in response to dynamic traffic conditions.</p>
<p>To use this type of control, the <code>&lt;tlLogic&gt;</code>-element needs to receive the attribute
<code>type="actuated"</code>. It also requires the usage of the <code>phase</code>-attributes <code>minDur</code> and <code>maxDur</code> instead of <code>duration</code> to
define the allowed range of time durations for each phase (if these
values are equal or only <code>duration</code> is given, that phase will have constant
duration). Additional parameters may be used to configure the control
algorithm further. These may be given within the <code>&lt;tlLogic&gt;</code>-Element as follows:</p>
<h3 id="detectors">Detectors<a class="headerlink" href="#detectors" title="Permanent link">#</a></h3>
<p>The time gaps which determine the phase extensions are collected by induction loop detectors.
These detectors are placed automatically at a configurable distance (see below). If the incoming lanes are too short and there is a sequence of unique predecessor lanes, the detector will be placed on a predecessor lane at the computed distance instead.</p>
<p>Each lane incoming to the traffic light will receive a detector. However, not all detectors can be used in all phases.
In the current implementation, detectors for actuation are only used if all connections from the detector lane gets the unconditional green light ('G') in a particular phase. This is done to prevent useless phase extensions when the first vehicle on a given lane is not allowed to drive.
A simple fix is often the provide dedicate left turn lanes.</p>
<p>The detector names take the form <code>TLSID_PROGRAMID_EDGEINDEX.LANEINDEX</code> where</p>
<ul>
<li><strong>TLSID</strong> is the id of the tlLogic element</li>
<li><strong>PROGRAMID</strong> is the value attribute 'programID'</li>
<li><strong>EDGEINDEX</strong> is a running index that starts at 0 for edge that approaches tls linkIndex 0 (typically the northern approach)</li>
<li><strong>LANEINDEX</strong> is a running index for the current edge that starts at the first vehicular lane (sidewalks do not count)</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sumo will issue a warning of the form "... has no controlling detector" if a phase or link index does not have usable detectors.</p>
</div>
<p>Detector activation states can optionally be written to the <a href="Output/Traffic_Lights.html#optional_output">TLS output</a>.</p>
<h3 id="example">Example<a class="headerlink" href="#example" title="Permanent link">#</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;tlLogic</span> <span class="na">id=</span><span class="s">&quot;0&quot;</span> <span class="na">programID=</span><span class="s">&quot;my_program&quot;</span> <span class="na">offset=</span><span class="s">&quot;0&quot;</span> <span class="na">type=</span><span class="s">&quot;actuated&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;max-gap&quot;</span> <span class="na">value=</span><span class="s">&quot;3.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;detector-gap&quot;</span> <span class="na">value=</span><span class="s">&quot;2.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;passing-time&quot;</span> <span class="na">value=</span><span class="s">&quot;2.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;vTypes&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;show-detectors&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;file&quot;</span> <span class="na">value=</span><span class="s">&quot;NULL&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;freq&quot;</span> <span class="na">value=</span><span class="s">&quot;300&quot;</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;31&quot;</span> <span class="na">minDur=</span><span class="s">&quot;5&quot;</span> <span class="na">maxDur=</span><span class="s">&quot;45&quot;</span> <span class="na">state=</span><span class="s">&quot;GGggrrrrGGggrrrr&quot;</span><span class="nt">/&gt;</span>
  ...
<span class="nt">&lt;/tlLogic&gt;</span>
</code></pre></div>

<h3 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">#</a></h3>
<p>Several optional parameters can be used to control the behavior of actuated traffic lights. The examples values in the previous section are the default values for these parameters and their meaning is given below:</p>
<ul>
<li><strong>max-gap</strong>: the maximum time gap between successive vehicles that will cause the current phase to be prolonged
(within maxDur limit)</li>
<li><strong>detector-gap</strong>: determines the time distance between the (automatically generated) detector and the stop line in seconds (at
each lanes maximum speed). </li>
<li><strong>passing-time</strong>: estimates the headway between vehicles when passing the stop line. This sets an upper bound on the distance between detector and stop line according to the formula <code>(minDur / passingTime + 0.5) / 7.5</code>. The intent of this bound is to allow all vehicles between the detector and the stop line to pass the intersection within the minDur time. A warning will be issued if the minDur gives insufficient clearing time.</li>
<li><strong>linkMaxDur:X</strong> (where X is a traffic light index): This sets an additional maximum duration criterion based on individual signals green duration rather than phase duration.</li>
<li><strong>linkMinDur:X</strong> (where X is a traffic light index): This sets an additional minimum duration criterion based on individual signals green duration rather than phase duration.</li>
<li><strong>show-detectors</strong> controls whether generated detectors will be visible or hidden in <a href="../sumo-gui.html">sumo-gui</a>. The default for all traffic lights can be set with option <strong>--tls.actuated.show-detectors</strong>. It is also possible to toggle this value from within the GUI by right-clicking on a traffic light.</li>
<li>parameters <strong>vTypes</strong>, <strong>file</strong> and <strong>freq</strong> have the same meaning as for <a href="Output/Induction_Loops_Detectors_%28E1%29.html">regular
induction loop detectors</a>.</li>
<li><strong>coordinated</strong> (true/false) Influence there reference point for time-in-cycle when using <a href="#coordination">coordination</a></li>
<li><strong>cycleTime</strong> sets the cycle time (in s) when using <a href="#coordination">coordination</a>. Defaults to the sum of all phase 'durations' values.</li>
</ul>
<p>Some parameters are only used when a signal plan with <a href="#dynamic_phase_selection_phase_skipping">dynamic phase selection</a> is active:</p>
<ul>
<li><strong>inactive-threshold</strong> (default 180): The parameter sets the time in s after which an inactive phase will be entered preferentially.</li>
<li><strong>linkMinDur:X</strong> (where X is a traffic light index): This sets an additional minimum duration criterion based on individual signals rather than phase duration</li>
</ul>
<h3 id="visualization">Visualization<a class="headerlink" href="#visualization" title="Permanent link">#</a></h3>
<p>By setting the sumo option <strong>--tls.actuated.show-detectors</strong> the default visibility of detectors can be
set. Also, in <a href="../sumo-gui.html">sumo-gui</a> detectors can be
shown/hidden by right-clicking on an actuated traffic light and
selecting the corresponding menu entry.</p>
<p>The detectors used by an actuated traffic light will be colored to indicate their status:
- green color indicates that the detector is used to determine the length of the current phase
- white color indicates that the detector is not used in the current phase
- red color indicates that a vehicle was detected since the last time at which the controlled links at that lane had a green light (only if these links are currently red)
- magenta color indicates and active <a href="../sumo-gui.html#activating_detectors">override</a></p>
<h3 id="custom_detectors">Custom Detectors<a class="headerlink" href="#custom_detectors" title="Permanent link">#</a></h3>
<p>To use custom detectors (i.e. for custom placement or output) additional parameters can be defined where KEY is a lane that is incoming to the traffic light and VALUE is a user-defined inductionLoop (that could also lie on another upstream lane).</p>
<div class="codehilite"><pre><span></span><code>   &lt;param key=&quot;gneE42_2&quot; value=&quot;customDetector1&quot;/&gt;
</code></pre></div>

<p>By assigning the special value <code>NO_DETECTOR</code>, the detector for a given lane key can be completely disabled.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Custom detectors only work when the 'tlLogic' is loaded from an additional file.</p>
</div>
<p>Custom detector activation states can optionally be written to the <a href="Output/Traffic_Lights.html#optional_output">TLS output</a>.</p>
<p>To include further detectors in the output and in the <a href="#track_phases">phase tracker dialog</a> (i.e. when a custom logic uses laneArea detectors or multiple detectors on the same lane) the following declaration can be used to list all extra detectors:</p>
<div class="codehilite"><pre><span></span><code>   &lt;param key=&quot;extra-detectors&quot; value=&quot;customDetector1 customDetector2 ...&quot;/&gt;
</code></pre></div>

<h3 id="lane-specific_max-gap">Lane-specific max-gap<a class="headerlink" href="#lane-specific_max-gap" title="Permanent link">#</a></h3>
<p>To define a max-gap value that differs from the default you can use a param with <code>key="max-gap:&lt;LANE_ID&gt;"</code> where LANE_ID is a lane incoming to the traffic light (the detector might lie further upstream).</p>
<div class="codehilite"><pre><span></span><code>   &lt;param key=&quot;max-gap:gneE42_2&quot; value=&quot;2&quot;/&gt;
</code></pre></div>

<h3 id="coordination">Coordination<a class="headerlink" href="#coordination" title="Permanent link">#</a></h3>
<p>Actuated phases (minDur != maxDur) can be coordinated by adding attributes 'earliestEnd' and 'latestEnd'.
If these values are used, each step in the traffic light plan is assigned a 'timeInCycle' value depending on the value of param 'coordinated' (default 'false').</p>
<ul>
<li>coordinated=true:  timeInCycle = <em>(simulationTime - offset) % cycleTime</em>  (where cycleTime is taken from the param with key=cycleTime)</li>
<li>coordinated=false: timeInCycle = <em>time since last switching into phase 0</em></li>
</ul>
<p>If 'earliestEnd' is set, a phase can not end while <em>timeInCycle &lt; earliestEnd</em> (effectively increasing minDur)
If 'latestEnd' is set, a phase cannot be prolonged when <em>timeInCycle = latestEnd</em> (effectively reducing maxDur).</p>
<p>When setting 'latestEnd' &lt; 'earliestEnd', the phase can be extended into the next cycle.
If both values are defined and a phase has already started and ended in the
current cycle, both values will be shifted into the next cycle to avoid having a
phase run more than once in the same cycle (this only happens when param
'coordinated' is set to 'true').</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;tlLogic</span> <span class="na">id=</span><span class="s">&quot;0&quot;</span> <span class="na">programID=</span><span class="s">&quot;my_program&quot;</span> <span class="na">offset=</span><span class="s">&quot;10&quot;</span> <span class="na">type=</span><span class="s">&quot;actuated&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;coordinated&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;cycleTime&quot;</span> <span class="na">value=</span><span class="s">&quot;60&quot;</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;31&quot;</span> <span class="na">minDur=</span><span class="s">&quot;5&quot;</span> <span class="na">maxDur=</span><span class="s">&quot;45&quot;</span> <span class="na">state=</span><span class="s">&quot;GGggrrrrGGggrrrr&quot;</span> <span class="na">earliestEnd=</span><span class="s">&quot;10&quot;</span> <span class="na">latestEnd=</span><span class="s">&quot;50&quot;</span><span class="nt">/&gt;</span>
  ...
<span class="nt">&lt;/tlLogic&gt;</span>
</code></pre></div>

<h3 id="dynamic_phase_selection_phase_skipping">Dynamic Phase Selection (Phase Skipping)<a class="headerlink" href="#dynamic_phase_selection_phase_skipping" title="Permanent link">#</a></h3>
<p>When a phase uses attribute 'next' with a list of indices. The next phase is chosen dynamically based on the detector status of all candidate phases according to the following algorithm:</p>
<ul>
<li>compute the priority for each phase given in 'next'. Priority is primarily given by the number of active detectors for that phase. Active means either of:<ul>
<li>with detection gap below threshold</li>
<li>with a detection since the last time where the signal after this detector was green</li>
</ul>
</li>
<li>the current phase is implicitly available for continuation as long as it's maxDur is not reached. Detectors of the current phase get a bonus priority</li>
<li>the phase with the highest priority is used with phases coming earlier in the next list given precedence over those coming later</li>
<li>if there is no traffic, the phases will run through a default cycle defined by the first value in the 'next' attribute</li>
<li>if a particular phase should remain active indefinitely in the absence of traffic it must have its own index in the 'next' list as well as a high maxDur value</li>
<li>if an active detector was not served for a given time threshold (param <strong>inactive-threshold</strong>), this detector receives bonus priority according the time it was not served. This can be used to prevent starvation if other phases are consistently preferred due to serving more traffic </li>
</ul>
<p>Examples for this type of traffic light logic can be found in <a href="https://github.com/eclipse/sumo/blob/main/tests/sumo/basic/tls/actuated/dualring_simple"><strong><em>&lt;SUMO_HOME&gt;</em></strong>/tests/sumo/basic/tls/actuated/dualring_simple</a>.</p>
<p>The helper script [tls_buildTransitions.py] can be used to generate such logics from simplified definitions.</p>
<h2 id="type_actuated_with_custom_switching_rules">Type 'actuated' with custom switching rules<a class="headerlink" href="#type_actuated_with_custom_switching_rules" title="Permanent link">#</a></h2>
<p>By default, all traffic light programs are governed by the same pre-defined rules
that determine which detectors are used or ignored in each phase. If more
flexibility is needed, custom conditions can be defined by using the phase
attributes 'earlyTarget' and 'finalTarget' to define logical expressions.</p>
<p>If the controller is in an actuated phase (minDur &lt; maxDur) and could switch
into a new phase, the attribute 'earlyTarget' of the new phase is evaluated. If
the expression evaluates to 'true', the controller switches into the new phase.
Otherwise it remains in the current phase. If the current phase has multiple successors (attribute 'next'),
the candidates are evaluated from left to right and the first candidate where 'earlyTarget' evaluates to true is used.</p>
<p>If the controller has reached the maximum duration of it's current phase and
multiple successor phases are defined with attribute 'next', the
attribute 'finalTarget' of all candidate phases is evaluated from left to right.
The first phase where the expression evaluates to 'true' is used.
Otherwise, the rightmost phase in the next-list is used.</p>
<p>The following elements are permitted in an expression for attributes
'earlyTarget' and 'finalTarget':</p>
<ul>
<li>numbers</li>
<li>comparators &lt;,&gt;,=,&lt;=,&gt;=</li>
<li>mathematical operators +,-,<em>,/,</em>*,%</li>
<li>logical operators 'or', 'and', '!'</li>
<li>parentheses (,)</li>
<li>pre-defined functions:<ul>
<li>'z:DETID': returns the time gap since the last vehicle detection for inductionLoop detector with id 'DETID' or id 'TLSID_PROGRAMID_DETID' (DETID may omit the the <a href="#detectors">prefix 'TLSID_PROGRAMID_'</a>)</li>
<li>'a:DETID': returns number of vehicles on detector with id 'DETID'. Supports inductionLoop and laneAreaDetectors. Also supports omitting the prefix of the detector id. (see 'z:')</li>
<li>'g:TLSINDEX': returns current green duration in seconds for link with the given index</li>
<li>'r:TLSINDEX': returns current red duration in seconds for link with the given index</li>
<li>'c:': returns the time within the current cycle</li>
</ul>
</li>
<li><a href="#custom_function_definitions">use-defined functions</a> FNAME:arg1,args2,...,argN  where arg may be any expression that does not contain spaces (except within parentheses)</li>
<li>Symbolic names for <a href="#named_expressions">pre-defined expressions</a></li>
</ul>
<p>The following constraints apply to expressions:</p>
<ul>
<li>all elements of an expression must be separated by a space character (' ')
  with the exception of the operator '!' (logical negation) which must precede it's operand without a space.</li>
</ul>
<h3 id="named_expressions">Named Expressions<a class="headerlink" href="#named_expressions" title="Permanent link">#</a></h3>
<p>To organize expressions, the element <code>&lt;condition&gt;</code> may be used as a child element
of <code>&lt;tlLogic&gt;</code> to define named expressions that can be referenced in other expressions:</p>
<div class="codehilite"><pre><span></span><code>&lt;tlLogic id=&quot;example&quot; type=&quot;actuated&quot; ...&gt;
   &lt;condition id=&quot;C3&quot; value=&quot;z:det5 &gt; 5&quot;/&gt;
   &lt;condition id=&quot;C4&quot; value=&quot;C3 and z:det6 &lt; 2&quot;/&gt;
   &lt;condition id=&quot;C5&quot; value=&quot;g:3 &gt; 20&quot;/&gt;
   ...
</code></pre></div>

<ul>
<li><strong>id</strong> must be an alphanumeric string without spaces and without the ':'-character</li>
<li><strong>value</strong> may be any expression which is permitted for 'earlyTarget' or 'finalTarget'</li>
</ul>
<p>Condition values can be <a href="Traffic_Lights.html#track_phases">visualized</a> while the simulation is running. By default all conditions are listed (if the corresponding visualization option is active). If many conditions are defined, it may be useful to list only a subset in the tracker window. For this purpose <em>either</em> one of the following <code>&lt;param&gt;</code>-definitions may be used as child element of the <code>&lt;tlLogic&gt;</code>:</p>
<ul>
<li><code>&lt;param key="show-conditions" value="C1 C4"/&gt;</code>: shows only the conditions with listed id.</li>
<li><code>&lt;param key="hide-conditions" value="C3 C4"/&gt;</code>: shows only the conditions which are not listed</li>
</ul>
<p>The values of (visible) named expressions can optionally be written to the <a href="Output/Traffic_Lights.html#optional_output">TLS output</a>.</p>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">#</a></h3>
<h4 id="diverse_logical_conditions">Diverse Logical Conditions<a class="headerlink" href="#diverse_logical_conditions" title="Permanent link">#</a></h4>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;tlLogic</span> <span class="na">id=</span><span class="s">&quot;example&quot;</span> <span class="na">type=</span><span class="s">&quot;actuated&quot;</span> <span class="err">...</span><span class="nt">&gt;</span>
   <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;C3&quot;</span> <span class="na">value=</span><span class="s">&quot;z:Det2.0 &gt; 5&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;C4&quot;</span> <span class="na">value=</span><span class="s">&quot;C3 and z:Det0.0 &lt; 2&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;C5&quot;</span> <span class="na">value=</span><span class="s">&quot;r:0 &gt; 60&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;phase</span> <span class="err">...</span> <span class="na">next=</span><span class="s">&quot;1 2&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;phase</span> <span class="err">...</span> <span class="na">earlyTarget=</span><span class="s">&quot;C3&quot;</span> <span class="na">finalTarget=</span><span class="s">&quot;!C4&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;phase</span> <span class="err">...</span> <span class="na">earlyTarget=</span><span class="s">&quot;(z:D2.0 &gt; 3) and (z:D3.1 &lt;= 4)&quot;</span> <span class="na">finalTarget=</span><span class="s">&quot;C5 or (z:Det3.1 = 0)&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tlLogic&gt;</span>
</code></pre></div>

<h4 id="default_gap_control_logic">Default Gap Control Logic<a class="headerlink" href="#default_gap_control_logic" title="Permanent link">#</a></h4>
<p>The default gap control logic, replicated with custom conditions. A complete scenario including network and detector definitions can be downloaded <a href="https://sumo.dlr.de/extractTest.php?path=sumo/basic/tls/actuated/conditions/replicate_default">here</a>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;tlLogic</span> <span class="na">id=</span><span class="s">&quot;C&quot;</span> <span class="na">type=</span><span class="s">&quot;actuated&quot;</span> <span class="na">programID=</span><span class="s">&quot;P1&quot;</span> <span class="na">offset=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;33&quot;</span> <span class="na">state=</span><span class="s">&quot;GgrrGgrr&quot;</span> <span class="na">minDur=</span><span class="s">&quot;5&quot;</span> <span class="na">maxDur=</span><span class="s">&quot;60&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;3&quot;</span>  <span class="na">state=</span><span class="s">&quot;ygrrygrr&quot;</span> <span class="na">earlyTarget=</span><span class="s">&quot;NS&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;6&quot;</span>  <span class="na">state=</span><span class="s">&quot;rGrrrGrr&quot;</span> <span class="na">minDur=</span><span class="s">&quot;5&quot;</span> <span class="na">maxDur=</span><span class="s">&quot;60&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;3&quot;</span>  <span class="na">state=</span><span class="s">&quot;ryrrryrr&quot;</span> <span class="na">earlyTarget=</span><span class="s">&quot;NSL&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;33&quot;</span> <span class="na">state=</span><span class="s">&quot;rrGgrrGg&quot;</span> <span class="na">minDur=</span><span class="s">&quot;5&quot;</span> <span class="na">maxDur=</span><span class="s">&quot;60&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;3&quot;</span>  <span class="na">state=</span><span class="s">&quot;rrygrryg&quot;</span> <span class="na">earlyTarget=</span><span class="s">&quot;EW&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;6&quot;</span>  <span class="na">state=</span><span class="s">&quot;rrrGrrrG&quot;</span> <span class="na">minDur=</span><span class="s">&quot;5&quot;</span> <span class="na">maxDur=</span><span class="s">&quot;60&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;3&quot;</span>  <span class="na">state=</span><span class="s">&quot;rrryrrry&quot;</span> <span class="na">earlyTarget=</span><span class="s">&quot;EWL&quot;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;NS&quot;</span>  <span class="na">value=</span><span class="s">&quot;z:D0.0 &gt; 3 and z:D2.0 &gt; 3&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;NSL&quot;</span> <span class="na">value=</span><span class="s">&quot;z:D0.1 &gt; 3 and z:D2.1 &gt; 3&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;EW&quot;</span>  <span class="na">value=</span><span class="s">&quot;z:D1.0 &gt; 3 and z:D3.0 &gt; 3&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;EWL&quot;</span> <span class="na">value=</span><span class="s">&quot;z:D1.1 &gt; 3 and z:D3.1 &gt; 3&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/tlLogic&gt;</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The the expression 'z:D0.0' retrieves the detection gap of detector 'C_PI_D0.0' but the prefix 'C_PI_' may be omitted.</p>
</div>
<h3 id="overriding_phase_attributes_with_expressions">Overriding Phase Attributes with Expressions<a class="headerlink" href="#overriding_phase_attributes_with_expressions" title="Permanent link">#</a></h3>
<p>By default, the phase attributes 'minDur', 'maxDur', 'earliestEnd' and 'latestEnd' are defined numerically (or left undefined).
It may be desireable to redefine these attributes with expressions (i.e. condition ids or condition values) for the following reasons:</p>
<ul>
<li>the switching logic may be expressed more succinctly if these values can change dynamically during the signals operation</li>
<li>the phase definitions shall be reused for multiple programs and all variability shall be expressed in table of constants (defined via <code>&lt;conditions&gt;</code>s)</li>
</ul>
<p>To override these attributes, their value in the <code>&lt;phase&gt;</code> must be defined as <code>-1</code>. For each phase and attribute a corresponding condition must be defined with the <code>id = &lt;ATTRNAME&gt;:&lt;PHASEINDEX&gt;</code> as in the example below:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;tlLogic</span> <span class="na">id=</span><span class="s">&quot;C&quot;</span> <span class="na">type=</span><span class="s">&quot;actuated&quot;</span> <span class="na">programID=</span><span class="s">&quot;P1&quot;</span> <span class="na">offset=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;33&quot;</span> <span class="na">state=</span><span class="s">&quot;GgrrGgrr&quot;</span> <span class="na">minDur=</span><span class="s">&quot;10&quot;</span> <span class="na">maxDur=</span><span class="s">&quot;65&quot;</span> <span class="na">name=</span><span class="s">&quot;NS&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;3&quot;</span>  <span class="na">state=</span><span class="s">&quot;ygrrygrr&quot;</span> <span class="na">earlyTarget=</span><span class="s">&quot;NS&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;6&quot;</span>  <span class="na">state=</span><span class="s">&quot;rGrrrGrr&quot;</span> <span class="na">minDur=</span><span class="s">&quot;10&quot;</span> <span class="na">maxDur=</span><span class="s">&quot;65&quot;</span> <span class="na">name=</span><span class="s">&quot;NSL&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;3&quot;</span>  <span class="na">state=</span><span class="s">&quot;ryrrryrr&quot;</span> <span class="na">earlyTarget=</span><span class="s">&quot;NSL&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;33&quot;</span> <span class="na">state=</span><span class="s">&quot;rrGgrrGg&quot;</span> <span class="na">minDur=</span><span class="s">&quot;-1&quot;</span> <span class="na">maxDur=</span><span class="s">&quot;-1&quot;</span> <span class="na">name=</span><span class="s">&quot;EW&quot;</span> <span class="na">earliestEnd=</span><span class="s">&quot;-1&quot;</span> <span class="na">latestEnd=</span><span class="s">&quot;-1&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;3&quot;</span>  <span class="na">state=</span><span class="s">&quot;rrygrryg&quot;</span> <span class="na">earlyTarget=</span><span class="s">&quot;EW&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;6&quot;</span>  <span class="na">state=</span><span class="s">&quot;rrrGrrrG&quot;</span> <span class="na">minDur=</span><span class="s">&quot;10&quot;</span> <span class="na">maxDur=</span><span class="s">&quot;65&quot;</span> <span class="na">name=</span><span class="s">&quot;EWL&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;3&quot;</span>  <span class="na">state=</span><span class="s">&quot;rrryrrry&quot;</span> <span class="na">earlyTarget=</span><span class="s">&quot;EWL&quot;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;minDur:4&quot;</span>      <span class="na">value=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;maxDur:4&quot;</span>      <span class="na">value=</span><span class="s">&quot;65&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;earliestEnd:4&quot;</span> <span class="na">value=</span><span class="s">&quot;60&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;latestEnd:4&quot;</span>   <span class="na">value=</span><span class="s">&quot;80&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;/tlLogic&gt;</span>
</code></pre></div>

<h3 id="storing_and_modifying_custom_data">Storing and modifying custom data<a class="headerlink" href="#storing_and_modifying_custom_data" title="Permanent link">#</a></h3>
<p>The <code>&lt;condition&gt;</code> elements described above can be used to define complex expressions as well as numerical constants that control program operation.
It may sometimes be useful to store and modify numerical values that persist over consecutive invocations of the control logic. To this end the element <code>&lt;assignment&gt;</code>  may be used as a child element of <code>&lt;tlLogic&gt;</code> to define conditional assignment of new values to <a href="#named_expressions">named expressions</a>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;tlLogic</span> <span class="na">id=</span><span class="s">&quot;example&quot;</span> <span class="na">type=</span><span class="s">&quot;actuated&quot;</span> <span class="err">...</span><span class="nt">&gt;</span>

        <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;NS&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;nSw&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;assignment</span> <span class="na">id=</span><span class="s">&quot;nSw&quot;</span> <span class="na">check=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;nSw + 1&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;assignment</span> <span class="na">id=</span><span class="s">&quot;NS&quot;</span>  <span class="na">check=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>    
        <span class="nt">&lt;assignment</span> <span class="na">id=</span><span class="s">&quot;NS&quot;</span>  <span class="na">check=</span><span class="s">&quot;z:D0.0 &gt; 3 and z:D2.0 &gt; 3&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
   ...
<span class="nt">&lt;/tlLogic&gt;</span>
</code></pre></div>

<ul>
<li><strong>id</strong> may be any alphanumeric id</li>
<li><strong>check</strong> may be any expression which is permitted for condition values</li>
<li><strong>value</strong> may be any expression which is permitted for conditions values</li>
</ul>
<p>Every time the control logic is executed, all <code>assignment</code>s are executed in the order they are defined: If the the 'check'-expression evaluates to true (a non-0 value), the 'value'-expression is evaluated and the result is stored under the given id:</p>
<ul>
<li>if <strong>id</strong> is the id of a condition element, the value of that conditions is replaced by a string representation of the result (The accuracy of this representation is limited by simulation option <strong>--precision</strong>)</li>
<li>if <strong>id</strong> is not the id of a condition element, a double valued variable with that id is created / updated in the current scope. If the assignment is not part of a <a href="#custom_function_definitions">use-defined functions</a>, this is the global scope</li>
</ul>
<p>The test case <a href="https://sumo.dlr.de/extractTest.php?path=sumo/basic/tls/actuated/conditions/assignments/find_primes">find_primes</a> computes all prime numbers below 100 inside the traffic light controller as a capability demonstration.</p>
<h3 id="custom_function_definitions">Custom function definitions<a class="headerlink" href="#custom_function_definitions" title="Permanent link">#</a></h3>
<p>Custom functions are a mechanism that allows to execute multiple assignments with custom arguments.
They are defined with the <code>&lt;function&gt;</code> element within a <code>&lt;tlLogic&gt;</code> as shown below:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;tlLogic</span> <span class="na">id=</span><span class="s">&quot;example&quot;</span> <span class="na">type=</span><span class="s">&quot;actuated&quot;</span> <span class="err">...</span><span class="nt">&gt;</span>

  <span class="nt">&lt;function</span> <span class="na">id=</span><span class="s">&quot;FNAME&quot;</span> <span class="na">nArgs=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;assignment</span> <span class="na">id=</span><span class="s">&quot;COND1&quot;</span> <span class="na">check=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;$1 + $2&quot;</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;assignment</span> <span class="na">id=</span><span class="s">&quot;$0&quot;</span> <span class="na">check=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;COND1 * COND1&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/function&gt;</span>

  <span class="nt">&lt;condition</span> <span class="na">id=</span><span class="s">&quot;COND2&quot;</span> <span class="na">value=</span><span class="s">&quot;FNAME:3,4&quot;</span><span class="nt">/&gt;</span>
   ...
<span class="nt">&lt;/tlLogic&gt;</span>
</code></pre></div>

<ul>
<li><strong>id</strong> may be any alphanumeric string</li>
<li><strong>nArgs</strong> is the number of arguments required by the function</li>
<li><strong>$0</strong> is the value returned by the function</li>
<li><strong>$1 ... $n</strong> are the values of the functions arguments in the order they are supplied after the <strong>:</strong></li>
<li>when a function is evaluted, all it's assignments are evaluted in definition order</li>
<li>functions may not assign to any defined <code>&lt;condition&gt;</code> id</li>
<li>assignments are local to the function</li>
<li>a function call takes the form <strong>id:arg_1,arg_2,...arg_n</strong> and there must be no spaces between the arguments and the commas (except within parentheses)</li>
<li>a function is evaluated within the calling scope (ids assigned to by a function are accessible in a nested function call but assignments are not propagated back to the caller)</li>
</ul>
<p>in the above example COND2 receives a value of 49</p>
<h2 id="type_delay_based">Type 'delay_based'<a class="headerlink" href="#type_delay_based" title="Permanent link">#</a></h2>
<p>Similar to the control by time gaps between vehicles, a phase
prolongation can also be triggered by the presence of vehicles with time
loss. A TLS with this actuation type can be defined as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;tlLogic</span> <span class="na">id=</span><span class="s">&quot;0&quot;</span> <span class="na">programID=</span><span class="s">&quot;my_program&quot;</span> <span class="na">offset=</span><span class="s">&quot;0&quot;</span> <span class="na">type=</span><span class="s">&quot;delay_based&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;detectorRange&quot;</span> <span class="na">value=</span><span class="s">&quot;100&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;minTimeLoss&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;file&quot;</span> <span class="na">value=</span><span class="s">&quot;NULL&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;freq&quot;</span> <span class="na">value=</span><span class="s">&quot;300&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">key=</span><span class="s">&quot;show-detectors&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;31&quot;</span> <span class="na">minDur=</span><span class="s">&quot;5&quot;</span> <span class="na">maxDur=</span><span class="s">&quot;45&quot;</span> <span class="na">state=</span><span class="s">&quot;GGggrrrrGGggrrrr&quot;</span><span class="nt">/&gt;</span>
  ...
<span class="nt">&lt;/tlLogic&gt;</span>
</code></pre></div>

<p>Here, the <code>detectorRange</code> specifies the upstream detection range in meters measured
from the stop line. Per default (if the parameter is left undefined) the
underlying <a href="Output/Lanearea_Detectors_%28E2%29.html">E2
detector</a> is
assumed to cover the first approaching lanes completely. The time loss
for a vehicle is accumulated as soon as it enters the detector range. If
its accumulated time loss exceeds the value of <code>minTimeLoss</code> (current default is one
second) seconds a prolongation of the corresponding green phase is
requested if it is active. The instantaneous time loss of a vehicle is
defined as <code>1 - v/v_max</code>, where <code>v</code> is its current velocity and <code>v_max</code>
the allowed maximal velocity. See [Oertel, Robert, and Peter Wagner.
"Delay-time actuated traffic signal control for an isolated
intersection." Transportation Research Board 2011 (90th Annual Meeting).
2011.] for details.</p>
<h3 id="custom_detectors_1">Custom Detectors<a class="headerlink" href="#custom_detectors_1" title="Permanent link">#</a></h3>
<p>To use custom detectors (i.e. for custom placement or output) additional parameters can be defined where KEY is a lane that is incoming to the traffic light and VALUE is a user-defined laneAreaDetector.</p>
<div class="codehilite"><pre><span></span><code>   &lt;param key=&quot;gneE42_2&quot; value=&quot;customDetector1&quot;/&gt;
</code></pre></div>

<div class="admonition caution">
<p class="admonition-title">Caution</p>
</div>
<p>Custom detectors only work when the 'tlLogic' is loaded from an additional file.</p>
<h2 id="type_nema">Type 'NEMA'<a class="headerlink" href="#type_nema" title="Permanent link">#</a></h2>
<p>Since version 1.11.0, SUMO supports defining controllers with the naming
convention and control logic according to the 'National Electrical Manufacturers
Association' commonly used throughout the United States.
Detailed documentation is at <a href="NEMA.html">NEMA</a>.</p>
<h3 id="custom_detectors_2">Custom Detectors<a class="headerlink" href="#custom_detectors_2" title="Permanent link">#</a></h3>
<p>To use custom detectors (i.e. for custom placement or output) additional parameters can be defined where KEY is a lane that is incoming to the traffic light and VALUE is a user-defined laneAreaDetector.</p>
<div class="codehilite"><pre><span></span><code>   &lt;param key=&quot;gneE42_2&quot; value=&quot;customDetector1&quot;/&gt;
</code></pre></div>

<div class="admonition caution">
<p class="admonition-title">Caution</p>
</div>
<p>Custom detectors only work when the 'tlLogic' is loaded from an additional file.</p>
<p>Detector activation states (for default and custom detectors) can optionally be written to the <a href="Output/Traffic_Lights.html#optional_output">TLS output</a>.</p>
<h1 id="loading_a_new_program">Loading a new Program<a class="headerlink" href="#loading_a_new_program" title="Permanent link">#</a></h1>
<p>After having defined a tls program as above, it can be loaded as an <a href="/docs/sumo.html#format_of_additional_files"><em>additional-file</em></a>; of
course, a single <a href="/docs/sumo.html#format_of_additional_files"><em>additional-file</em></a> may contain several programs. It is possible to load
several programs for a single tls into the simulation. The program
loaded last will be used (unless not defined differently using a WAUT
description). All subkeys of the additional programs must differ if they
describe the same tls.</p>
<p>Assuming the program as defined above is put in a file called
<em>tls.add.xml</em> it can be loaded in
<a href="../sumo.html">sumo</a>/<a href="../sumo-gui.html">sumo-gui</a> like this</p>
<div class="codehilite"><pre><span></span><code><span class="nv">sumo</span> <span class="o">-</span><span class="nv">a</span> <span class="nv">tls</span>.<span class="nv">add</span>.<span class="nv">xml</span> ...<span class="o">&lt;</span><span class="nv">other</span> <span class="nv">options</span> <span class="k">for</span> <span class="nv">network</span> <span class="nv">and</span> <span class="nv">routes</span><span class="o">&gt;</span>
</code></pre></div>

<p>It is also possible to load a program which switches the tls off by
giving the <code>programID</code> the value
"<code>off</code>".</p>
<div class="codehilite"><pre><span></span><code>&lt;tlLogic id=&quot;0&quot; type=&quot;static&quot; programID=&quot;off&quot;/&gt;
</code></pre></div>

<h1 id="tools_for_importing_tls_programs">Tools for Importing TLS Programs<a class="headerlink" href="#tools_for_importing_tls_programs" title="Permanent link">#</a></h1>
<p>Description from real-world traffic light systems do not arrive in form
of SUMO-traffic light descriptions normally. The main difference in
presentation comes from the fact that SUMO defines a new <code>&lt;phase&gt;</code> whenever any
of the controlled signals changes its state, whereas traffic engineers
differentiate between phases and phase transitions.</p>
<p>For an easier import than editing the XML by hand, some tools exists in
<strong><em>&lt;SUMO_HOME&gt;</em></strong>/tools/tls.</p>
<ul>
<li><a href="../Tools/tls.html#tls_csv2sumopy">tls_csv2SUMO.py</a>: this tool
  simplifies descriptions because it allows to define the duration of
  phases for each controlled edge-to-edge connection. Splitting into
  smaller SUMO-phases because other signals change is done
  automatically.</li>
<li><a href="../Tools/tls.html#tls_csvsignalgrouppy">tls_csvSignalGroup.py</a>:
  this tool further simplifies descriptions because it allows to
  define the start and end times of green-phases per signal group (up
  to 2 green phases, actually) and the transitions (yellow,
  red-yellow) are added automatically. The splitting into smaller
  SUMO-phases is also done automatically.</li>
</ul>
<p>Alternatively <a href="../Netedit/index.html">netedit</a> can be used to edit programs
using a graphical user interface.</p>
<h1 id="modifying_existing_tls-programs">Modifying Existing TLS-Programs<a class="headerlink" href="#modifying_existing_tls-programs" title="Permanent link">#</a></h1>
<p>To modify the program of a traffic light it is generally necessary to
<a href="#loading_new_tls-programs">load a new program</a>. However, in
the special case that only the offset shall be modified it is also
possible to specify a new offset for an existing traffic light id and
programID:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;additional&gt;</span>
  <span class="nt">&lt;tlLogic</span> <span class="na">id=</span><span class="s">&quot;0&quot;</span> <span class="na">programID=</span><span class="s">&quot;0&quot;</span> <span class="na">offset=</span><span class="s">&quot;42&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/additional&gt;</span>
</code></pre></div>

<h1 id="controlling_multiple_junctions_with_the_same_controller">Controlling multiple Junctions with the same controller<a class="headerlink" href="#controlling_multiple_junctions_with_the_same_controller" title="Permanent link">#</a></h1>
<p>In SUMO, a traffic light controller can control an arbitrary number of
junctions simultaneously. This is accomplished by one of the following
methods:</p>
<ul>
<li>Defining the same <em>tl</em> attribute (the controller ID) for a set of
  nodes in <em>.nod.xml</em> file when building the network with
  <a href="../netconvert.html">netconvert</a></li>
<li>Setting the same <em>tl</em> attribute for multiple nodes in
  <a href="../Netedit/index.html">netedit</a></li>
<li>Setting the option <strong>--tls.join</strong> when building the network with
  <a href="../netconvert.html">netconvert</a>. This will automatically join
  the traffic lights of nodes in close proximity within a default
  distance of 20m (customizable by setting option <strong>tls.join-dist</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FLOAT&gt;</em></a>).</li>
</ul>
<p>Note, that in this case the state vector for each phase will be as long
as the total number of controlled intersections. Also, the tls indices
for the connections will differ from the link indices (as the latter
starts with 0 for each intersection whereas the tls indices are unique
within a controller).</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The generated TLS program will attempt to identify the main directions but usually this needs some manual corrections.</p>
</div>
<h1 id="defining_signal_groups">Defining Signal Groups<a class="headerlink" href="#defining_signal_groups" title="Permanent link">#</a></h1>
<p>In SUMO every lane-to-lane connection at a controlled intersection is
assigned an index called <em>link tls index</em>. This index is used to
determine the state for each phase by looking up the character code at
that index in the state vector. The link index can be shown in
<a href="../sumo-gui.html">sumo-gui</a> by setting the junction visualization
option <em>show link tls index</em>. By default link indices are unique for
each connection and assigned in a clockwise manner starting at the north
(the same as the junction link index which is used for defining
right-of-way rules). When <a href="#controlling_multiple_junctions_with_the_same_controller">defining joint
TLS</a>,
the indices continue their numbering in the order of the controlled
junctions.</p>
<p>The tls index for each connection can be <a href="../Networks/PlainXML.html#controlled_connections">freely assigned in a
<em>.tll.file</em></a>
or by setting attribute <em>linkIndex</em> in <a href="../Netedit/index.html">netedit</a>. By
assigning the <strong>same</strong> index to multiple connection they form a signal
group and always show the same state (simply because they reference the
same state index). This allows shortening and thus simplifying the state
vector.</p>
<h2 id="automatic_creation_of_signal_groups">Automatic Creation of Signal Groups<a class="headerlink" href="#automatic_creation_of_signal_groups" title="Permanent link">#</a></h2>
<p><a href="../netconvert.html">netconvert</a> supports automatic definition of signal groups by setting option <strong>--tls.group-signals</strong>.
To replace existing signal groups with a 1-to-1 assignment of connections to indices, the option <strong>--tls.ungroup-signals</strong> can be used.</p>
<p><a href="../Netedit/index.html">netedit</a> also supports creation and removal of signal groups using the functions 'Group Signals' and 'Ungroup Signals' in traffic light mode frame.</p>
<h1 id="defining_program_switch_times_and_procedure">Defining Program Switch Times and Procedure<a class="headerlink" href="#defining_program_switch_times_and_procedure" title="Permanent link">#</a></h1>
<p>In practice, a tls often uses different programs during a day and maybe
also for weekdays and for the weekend days. It is possible to load a
definition of switch times between the programs using a WAUT (short for
"Wochenschaltautomatik" ~ weekly switch automatism).</p>
<p>Given a tls which knows four programs - two for weekdays and two for
weekend days where from 22:00 till 6:00 the night plan shall be used and
from 6:00 till 22:00 the day plan, and already defined programs, named
"weekday_night", "weekday_day", "weekend_night", "weekend_day". To
describe the switch process, we have to describe the switch at first,
assuming our simulation runs from monday 0.00 (second 0) to monday 0.00
(second 604800):</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;WAUT</span> <span class="na">refTime=</span><span class="s">&quot;0&quot;</span> <span class="na">id=</span><span class="s">&quot;myWAUT&quot;</span> <span class="na">startProg=</span><span class="s">&quot;weekday_night&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;wautSwitch</span> <span class="na">time=</span><span class="s">&quot;21600&quot;</span> <span class="na">to=</span><span class="s">&quot;weekday_day&quot;</span><span class="nt">/&gt;</span>    <span class="cm">&lt;!-- monday, 6.00 --&gt;</span>
    <span class="nt">&lt;wautSwitch</span> <span class="na">time=</span><span class="s">&quot;79200&quot;</span> <span class="na">to=</span><span class="s">&quot;weekday_night&quot;</span><span class="nt">/&gt;</span>  <span class="cm">&lt;!-- monday, 22.00 --&gt;</span>
    <span class="nt">&lt;wautSwitch</span> <span class="na">time=</span><span class="s">&quot;108000&quot;</span> <span class="na">to=</span><span class="s">&quot;weekday_day&quot;</span><span class="nt">/&gt;</span>   <span class="cm">&lt;!-- tuesday, 6.00 --&gt;</span>
... further weekdays ...
    <span class="nt">&lt;wautSwitch</span> <span class="na">time=</span><span class="s">&quot;453600&quot;</span> <span class="na">to=</span><span class="s">&quot;weekend_day&quot;</span><span class="nt">/&gt;</span>   <span class="cm">&lt;!-- saturday, 6.00 --&gt;</span>
... the weekend days ...
<span class="nt">&lt;/WAUT&gt;</span>
</code></pre></div>

<p>The fields in WAUT have the following meanings:</p>
<table>
<thead>
<tr>
<th>Attribute Name</th>
<th>Value Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>id</strong></td>
<td>string id</td>
<td>The name of the defined WAUT</td>
</tr>
<tr>
<td><strong>startProg</strong></td>
<td>string id</td>
<td>The program that will be used at the simulation's begin</td>
</tr>
<tr>
<td>refTime</td>
<td>time</td>
<td>A reference time which is used as offset to the switch times given later (in simulation seconds or D:H:M:S)</td>
</tr>
<tr>
<td>period</td>
<td>time</td>
<td>The period for repeating switch times. Disabled when set to &lt;= 0, default 0</td>
</tr>
</tbody>
</table>
<p>and the fields in wautSwitch:</p>
<table>
<thead>
<tr>
<th>Attribute Name</th>
<th>Value Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>time</strong></td>
<td>int</td>
<td>The time the switch will take place</td>
</tr>
<tr>
<td><strong>to</strong></td>
<td>string id</td>
<td>The name of the program the assigned tls shall switch to</td>
</tr>
</tbody>
</table>
<p>Of course, programs with the used names must be defined before this
definition is read. Also, the switch steps must be sorted by their
execution time.</p>
<p>Additionally, a definition about which tls shall be switched by the WAUT
must be given, as following:</p>
<div class="codehilite"><pre><span></span><code>&lt;wautJunction wautID=&quot;myWAUT&quot; junctionID=&quot;RCAS&quot; [procedure=&quot;Stretch&quot;] [synchron=&quot;t&quot;]/&gt;
</code></pre></div>

<p>Here, the attributes have the following meaning:</p>
<table>
<thead>
<tr>
<th>Attribute Name</th>
<th>Value Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>wautID</strong></td>
<td>string id</td>
<td>The id of the WAUT the tls shall be switched by</td>
</tr>
<tr>
<td><strong>junctionID</strong></td>
<td>string id</td>
<td>The name of the tls to assign to the WAUT</td>
</tr>
<tr>
<td><strong>procedure</strong></td>
<td>string enum</td>
<td>The switching algorithm to use ("GSP" or "Stretch"). If not set, the programs will switch immediately (default)</td>
</tr>
<tr>
<td><strong>synchron</strong></td>
<td>bool</td>
<td>Additional information whether the switch shall be done synchron (default: false)</td>
</tr>
</tbody>
</table>
<p>It is possible to assign several tls to a single WAUT. It is also
possible to assign several WAUTs to a single junction in theory, but
this is not done in reality.</p>
<p>A complete definition within an <a href="/docs/sumo.html#format_of_additional_files"><em>additional-file</em></a> is shown below. It would trigger
switching between programs <strong>S1</strong> and <strong>S2</strong> for traffic light logic
<strong>X</strong> with an initial program called <strong>0</strong>.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;additional&gt;</span>

  <span class="nt">&lt;tlLogic</span> <span class="na">id=</span><span class="s">&quot;X&quot;</span> <span class="na">type=</span><span class="s">&quot;static&quot;</span> <span class="na">programID=</span><span class="s">&quot;S1&quot;</span> <span class="na">offset=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;50&quot;</span> <span class="na">state=</span><span class="s">&quot;Gr&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;50&quot;</span> <span class="na">state=</span><span class="s">&quot;rG&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/tlLogic&gt;</span>

  <span class="nt">&lt;tlLogic</span> <span class="na">id=</span><span class="s">&quot;X&quot;</span> <span class="na">type=</span><span class="s">&quot;static&quot;</span> <span class="na">programID=</span><span class="s">&quot;S2&quot;</span> <span class="na">offset=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;30&quot;</span> <span class="na">state=</span><span class="s">&quot;Gr&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;phase</span> <span class="na">duration=</span><span class="s">&quot;80&quot;</span> <span class="na">state=</span><span class="s">&quot;rG&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/tlLogic&gt;</span>


  <span class="nt">&lt;WAUT</span> <span class="na">startProg=</span><span class="s">&quot;0&quot;</span> <span class="na">refTime=</span><span class="s">&quot;100&quot;</span> <span class="na">id=</span><span class="s">&quot;w1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;wautSwitch</span> <span class="na">to=</span><span class="s">&quot;S1&quot;</span> <span class="na">time=</span><span class="s">&quot;300&quot;</span><span class="nt">&gt;&lt;/wautSwitch&gt;</span>
    <span class="nt">&lt;wautSwitch</span> <span class="na">to=</span><span class="s">&quot;SS&quot;</span> <span class="na">time=</span><span class="s">&quot;800&quot;</span><span class="nt">&gt;&lt;/wautSwitch&gt;</span>
  <span class="nt">&lt;/WAUT&gt;</span>

  <span class="nt">&lt;wautJunction</span> <span class="na">junctionID=</span><span class="s">&quot;X&quot;</span> <span class="na">wautID=</span><span class="s">&quot;w1&quot;</span><span class="nt">&gt;&lt;/wautJunction&gt;</span>

<span class="nt">&lt;additional&gt;</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a traffic light program called "online" is loaded, this program will interrupt WAUT switching at that traffic light. This can be used to override WAUT behavior via TraCI.</p>
</div>
<h1 id="evaluation_of_traffic_lights_performance">Evaluation of Traffic Lights Performance<a class="headerlink" href="#evaluation_of_traffic_lights_performance" title="Permanent link">#</a></h1>
<h2 id="tools_for_automatic_detector_generation">Tools For Automatic Detector Generation<a class="headerlink" href="#tools_for_automatic_detector_generation" title="Permanent link">#</a></h2>
<p>Some tools are available which help generating detector definitions for
the evaluation of traffic lights. All are located in <strong><em>&lt;SUMO_HOME&gt;</em></strong>/tools/output.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The actuated traffic lights do not require detector definitions to be added as they generate their own detectors for internal use.</p>
</div>
<ul>
<li><strong><em>generateTLSE2Detectors.py</em></strong> generates a file which includes
  areal detectors. All lanes incoming into an intersection are covered
  with these detectors. The offset from the intersection may be given
  using the option <strong>--distance-to-TLS</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FLOAT&gt;</em></a> (or <strong>-d</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FLOAT&gt;</em></a>), the default is .1m. The generated detectors
  end either after a given length, defined using <strong>--detector-length</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FLOAT&gt;</em></a> (or <strong>-l</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FLOAT&gt;</em></a>) where the
  default is 250m, or at the lane's end if the lane is shorter than
  this length.</li>
<li><strong><em>generateTLSE3Detectors.py</em></strong> generates a file which includes
  multi-entry/multi-exit detectors. Detectors are built for each edge
  incoming to the traffic light. All lanes of each of these edges are
  covered with exit points. These point's offset from the intersection
  may be given using the option <strong>--distance-to-TLS</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FLOAT&gt;</em></a> (or <strong>-d</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FLOAT&gt;</em></a>), the default is .1m. The
  incoming edges are followed upstream, either until a given length,
  defined using <strong>--detector-length</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FLOAT&gt;</em></a> (or <strong>-l</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FLOAT&gt;</em></a>) where the default is 250m, or another traffic
  light is reached or no further upstream edge exists. Entry points
  are generated at these points.</li>
</ul>
<p>In both cases, the network must be given using the option <strong>--net-file</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FILE&gt;</em></a> (or <strong>-n</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FILE&gt;</em></a>). The
file including the detector definitions to generate may be given using
the option <strong>--output</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FILE&gt;</em></a> (or <strong>-o</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FILE&gt;</em></a>), default is "e2.add.xml" for areal detectors, and
"e3.add.xml" for multi-entry/multi-exit detectors. Per default, the
areal detectors generated by <strong><em>generateTLSE2Detectors.py</em></strong> are writing
their measures to "e2output.xml", the multi-entry/multi-exit detectors
generated by <strong><em>generateTLSE2Detectors.py</em></strong> to "e3output.xml". The
output file name can be changed for both scripts using the option <strong>--results-file</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FILE&gt;</em></a> (or <strong>-r</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;FILE&gt;</em></a>). The frequency of generated reports is 60s per default. It can be
changed using the option <strong>--frequency</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;INT&gt;</em></a> (or <strong>-f</strong> <a href="/docs/Basics/Notation.html#referenced_data_types"><em>&lt;INT&gt;</em></a>).</p>
<h1 id="controlling_traffic_lights_via_traci">Controlling traffic lights via TraCI<a class="headerlink" href="#controlling_traffic_lights_via_traci" title="Permanent link">#</a></h1>
<p><a href="../TraCI/Change_Traffic_Lights_State.html">TraCI provides various functions for controlling traffic
lights</a>. And the basic
approaches are outline below</p>
<h2 id="setting_the_phase">Setting the phase<a class="headerlink" href="#setting_the_phase" title="Permanent link">#</a></h2>
<p>A common pattern for implementing adaptive control via TraCI is to load
a program (usually from an
<a href="#defining_new_tls-programs">additional-file</a>) where all
green phases have a long duration (i.e. 1000s) to avoid switching by
SUMO and then use the <strong>setPhase</strong> function to switch to the next phase
(typically a yellow phase) whenever the green phase should end. The
nice thing about this approach is, that yellow phase and all-red phases
can still be handled automatically by SUMO and the control script simply
determines the duration of the current green phase.</p>
<p>To implement controllers with branching phase transitions, provide
multiple transitions to subsequent green phases and when calling
setPhase, select the yellow phase that starts the transition to the
target green phase.</p>
<p>These additional transition phases can be added to the end of the
program and the optional phase attribute "next" can be used to indicated the
next phase after the transition ends.</p>
<p>Tutorials for controlling traffic lights in this way can be found at
<a href="../Tutorials/index.html#traci_tutorials">Tutorials#TraCI_Tutorials</a>.</p>
<h2 id="setting_the_duration">Setting the duration<a class="headerlink" href="#setting_the_duration" title="Permanent link">#</a></h2>
<p>Using the function <strong>setPhaseDuration</strong>, the remaining duration for the
current phase can be modified. Note, that this does not take effect when
encountering the same phase again in the next phase cycle.</p>
<h2 id="setting_the_state">Setting the state<a class="headerlink" href="#setting_the_state" title="Permanent link">#</a></h2>
<p>Another method for controlling the traffic light is to set the signal
state for all links directly using the function
<em>setRedYellowGreenState</em>. After using this function, SUMO will not
modify the state anymore (until switching to another program using
<em>setProgram</em>). Consequently, the script must handle all phases and
transitions.</p>
<h2 id="setting_the_complete_program">Setting the complete Program<a class="headerlink" href="#setting_the_complete_program" title="Permanent link">#</a></h2>
<p>Using the method <strong>setProgramLogic</strong>, a static
signal plan can be loaded. Since this method requires a complex data
structure as argument, it is recommend to first obtain a data structure
using <strong>getAllProgramLogics</strong> and then modify it.</p>
<h2 id="switching_between_pre-defined_programs">Switching between pre-defined Programs<a class="headerlink" href="#switching_between_pre-defined_programs" title="Permanent link">#</a></h2>
<p>SUMO can load multiple traffic light programs from the <em>.net.mxl</em> file
and from <a href="#defining_new_tls-programs">additional files</a>. Using
the TraCI function <strong>setProgram</strong>, a script can switch between them.</p>
<h1 id="signal_plan_visualization">Signal Plan Visualization<a class="headerlink" href="#signal_plan_visualization" title="Permanent link">#</a></h1>
<p>In <a href="../sumo-gui.html">sumo-gui</a>, right-clicking on a traffic light allows opening up a menu that contains the items 'Show Phases' and 'Track Phases'.
These items open up new windows which are explained below</p>
<h2 id="show_phases">Show Phases<a class="headerlink" href="#show_phases" title="Permanent link">#</a></h2>
<p>This shows the signal states of all controlled links for the complete list of defined phases. Here, time is on the x-axis and there is one row for each link index. The time axis in the bottom shows the time of each phase change starting at 0.</p>
<p>The time can be switched between the following styles
- <strong>Seconds</strong>: absolute simulation time in seconds
- <strong>MM::SS</strong>: current minute and second (values repeat every hour)
- <strong>Time in Cycle</strong>: current second within the traffic light cycle (resets either when starting phase 0 or in some alignment to absolute simulation time).</p>
<p>Optionally, the green phase durations can be written for every phase. 
The top row contains the phase index but it is possible to change this so it shows phase names instead. (phase names are optional, and only the names of 'Green' phases are shown for brevity)</p>
<p><img alt="show_phases.png" src="../images/show_phases.png" title="Show Phases Window" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All phases will be shown in definition order. This may be different from their operational sequence if phase attribute 'next' is used.</p>
</div>
<h2 id="track_phases">Track Phases<a class="headerlink" href="#track_phases" title="Permanent link">#</a></h2>
<p>This shows the evolution of signal states for all controlled links for the last X seconds of operation (set via the 'Range' value). The basic layout is the same as for the 'Show Phases' Window. </p>
<p>The following additional features may be activated via checkboxes:</p>
<ul>
<li><strong>detector</strong>: shows activation states of all <a href="Traffic_Lights.html#detectors">detectors that are controlling this traffic light</a></li>
<li><strong>conditions</strong>: shows the boolean value of <a href="Traffic_Lights.html#named_expressions">conditions that are defined for this traffic light</a>. A colored block wil be drawn when the numerical value of the condition is different from zero.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When the mouse is placed over an active condition block, the numerical value of the condition will be shown.</p>
</div>
<p><img alt="track_phases.png" src="../images/track_phases.png" title="Track Phases Window" /></p>
                </div>
          </div>
          <button onclick="goTopFunction()" id="goToTop" title="Go to top"><i class="fa fa-arrow-up"></i></button>
        </div>

        <footer class="col-md-12">
          
            <br><small><i>本頁面最近更新日期：02 April 2022</i></small>
          
          <hr>
            <p>Copyright &copy; 2001-2022 德國航空太空中心 (DLR) 和其他貢獻者｜中文翻譯由 Yu-Hsuan Liao 及其他貢獻者維護</p>
          <p>在這些地方追蹤我們：<a class="no-arrow-link" href="https://www.twitter.com/eclipsesumo/"><i class="fa fa-twitter"></i></a> <a class="no-arrow-link" href="https://www.facebook.com/simulationofurbanmobility/"><i class="fa fa-facebook-square"></i></a> <a class="no-arrow-link" href="https://www.instagram.com/eclipse.sumo/"><i class="fa fa-instagram"></i></a>
          ｜本說明文件由 <a href="https://www.mkdocs.org/">MkDocs</a> 提供支援。</p>
        </footer>

      <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">搜尋</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">關閉</span></button>
            </div>
            <div class="modal-body" style="color: #495057 !important;">
                <p>Enter your search terms:</p>
                <script async src="https://cse.google.com/cse.js?cx=004302551366764109984:1kpgtzrm6kv"></script>
                <div class="gcse-search"></div>
            </div>
        </div>
    </div>
</div>
      <script>
        window.onscroll = function() {scrollFunction()};
        
        function scrollFunction() {
          if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("goToTop").style.display = "block";
          } else {
            document.getElementById("goToTop").style.display = "none";
          }
        }
    
        function goTopFunction() {
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
        }

        var base_url = "..",
            shortcuts = {"edit": 69, "help": 191, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>

        <script>
          const toggleSwitch = document.querySelector('#theme-switch input[type="checkbox"]');
  
          function switchTheme(e) {
              if (e.target.checked) {
                  localStorage.setItem('sumo-docs-theme', 'dark');
                  document.documentElement.setAttribute('data-theme', 'dark');
                  toggleSwitch.checked = true;
              } else {
                  localStorage.setItem('sumo-docs-theme', 'light');
                  document.documentElement.setAttribute('data-theme', 'light');
                  toggleSwitch.checked = false;
              }    
          }
  
          toggleSwitch.addEventListener('change', switchTheme, false);
  
          if (document.documentElement.getAttribute("data-theme") == "dark"){
              toggleSwitch.checked = true;
          }
          </script>

      <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Key</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody style="color: #495057 !important;">
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>開啟快速鍵列表</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>搜尋文件</td>
                  </tr>
                  <tr>
                    <td class="edit shortcut"><kbd>e</kbd></td>
                    <td>在 GitHub 上編輯本頁</td>
                  </tr>
                </tbody>
              </table>
            </div>
        </div>
    </div>
</div>
    </body>
</html>
